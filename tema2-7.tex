% TODO problemas en lstlistings: dentro de lstlisting, y por culpa de beamer, solo se pueden usar espacios y no tabs para indentar :(

\documentclass[hyperref={pdfpagelabels=false},tree-dvips,compress]{beamer}
% By  using hyperref={pdfpagelabels=false} you get rid off:
%	Package hyperref Warning: Option `pdfpagelabels' is turned off
%	(hyperref)                because \thepage is undefined.
%	Hyperref stopped early

% para imprimir las transparencias sin los pasos (\uncover), etc
%\documentclass[handout,hyperref={pdfpagelabels=false},tree-dvips,compress]{beamer}
%\usepackage{pgfpages}
%\pgfpagesuselayout{2 on 1}[a4paper,border shrink=5mm] % for instance

%para imprimir las transparencias pero con los pasos (\uncover), etc
% \documentclass[hyperref={pdfpagelabels=false},tree-dvips,compress]{beamer}
% \usepackage{pgfpages}
% \pgfpagesuselayout{2 on 1}[a4paper,border shrink=5mm] % for instance

% lista de themes: http://www.hartwork.org/beamer-theme-matrix/

%\usetheme{Warsaw} %muestra las secciones, pero ocupa mucho espacio
%\usetheme{Amsterdam}
%\usetheme{Darmstadt}

%\usetheme{CambridgeUS}
%\usecolortheme{whale}
%\usetheme{Frankfurt}

%\usetheme{Madrid}
%\usetheme{Boadilla}
%\usetheme{Frankfurt}
%\usetheme{Berlin}
%\usetheme{Dresden}

% theme customizada por nosotros:
\usecolortheme{whale}
\useinnertheme{default}
\useoutertheme[subsection=false,footline=authorinstitute]{miniframes}
\setbeamertemplate{navigation symbols}{}%remove navigation symbols

% Solo subsections en los circulos:
\usepackage{etoolbox}
\makeatletter
\patchcmd{\slideentry}{\advance\beamer@xpos by1\relax}{}{}{}
\newcommand*{\nofurther@beamer@link}{\gdef\beamer@link(##1/##2){}}
\pretocmd{\beamer@link}{\nofurther@beamer@link}{}{}
\let\beamer@linkorig=\beamer@link
\def\beamer@subsectionentry#1#2#3#4#5{\advance\beamer@xpos by1\relax\let\beamer@link=\beamer@linkorig}
\makeatother

% Añadir notas para el presentador:
% se añaden con \note{}
%\setbeameroption{show notes}
%\setbeameroption{hide notes} % default
%\setbeameroption{show notes on second screen=left}
%\setbeameroption{show only notes} % for printing the notes only

\usepackage[spanish]{babel}
\selectlanguage{spanish}
\usepackage[utf8]{inputenc}

\usepackage{adjustbox}
\usepackage{graphicx}

\usepackage{qtree}
%\usepackage{tree-dvips} % para que funcionen las anotaciones de tree-dvips: compilar a dvi, no usar pdflatex. Y luego de dvi, pasar a pdf.

\usepackage{xcolor}
\definecolor{green}{RGB}{0,170,0} % redefine green for visibility

\usepackage{bold-extra} % for having boldfaced monospaced font in listings
\usepackage{listings}
% para no perder los tabs en los listings:
% https://tex.stackexchange.com/questions/8370/how-to-prevent-beamer-from-removing-the-tab-alignment-of-lstlisting
\lstdefinestyle{procesos}{
	language=C,
	emptylines=1,
	breaklines=true,
	basicstyle=\ttfamily\bfseries\color{black},
	moredelim=**[is][\color{red}]{@red@}{@},
	moredelim=**[is][\color{violet}]{@vio@}{@},
	moredelim=**[is][\color{blue}]{@blue@}{@},
	moredelim=**[is][\color{green}]{@green@}{@},
}
\lstdefinestyle{codigo}{
	language=C,
	emptylines=1,
	breaklines=true,
	basicstyle=\tiny\ttfamily\color{black},
	%numbers=left,
	columns=fullflexible,
	keepspaces=true,
	tabsize=3,
	morecomment=[l]{//},
	moredelim=**[is][\color{red}]{@red@}{@},
	moredelim=**[is][\color{violet}]{@vio@}{@},
	moredelim=**[is][\color{blue}]{@blue@}{@},
	moredelim=**[is][\color{green}]{@green@}{@},
	moredelim=**[is][\bfseries]{@bold@}{@},
	tabsize=2,
	showtabs
}
\lstdefinestyle{codigoMP}{
	language=C,
	morekeywords={fun,ffun,cons,devuelve,si,no,sino,entonces},
	keywordstyle=\bfseries\color{black},
	emptylines=1,
	breaklines=true,
	basicstyle=\small\ttfamily,
	numbers=left,
	columns=fullflexible,
	keepspaces=true,
	tabsize=3,
	morecomment=[l]{//},
	commentstyle=\color{gray},
	moredelim=**[is][\color{red}]{@red@}{@},
	moredelim=**[is][\color{violet}]{@vio@}{@},
	moredelim=**[is][\color{green}]{@green@}{@},
	moredelim=**[is][\bfseries\color{blue}]{@b@}{@},
	tabsize=2,
	showtabs
}
\lstdefinestyle{gramaticas}{
	language=C,
	emptylines=1,
	breaklines=true,
	columns=fullflexible,
	keepspaces=true,
	tabsize=3,
	morekeywords={or,and,proc,iden,fproc,id,&,(,),if,then,while,do},
	keywordstyle=\itshape,
	basicstyle=\small\ttfamily,
	moredelim=**[is][\color{red}]{@red@}{@},
	moredelim=**[is][\color{magenta}]{@mag@}{@},
	moredelim=**[is][\color{blue}]{@blue@}{@},
	moredelim=**[is][\color{green}]{@green@}{@},
	moredelim=**[is][\bfseries\color{blue}]{@b@}{@},
	moredelim=**[is][\bfseries]{@bold@}{@}
}

\usepackage{tikz}
\usetikzlibrary{arrows,calc,shapes,decorations.pathreplacing,positioning}

\title{Tema 2.7. Subprogramas. Traducción}
\author{Pedro Javier Rodríguez Rodrigo, Víctor Cuadrado Juan}
%Basado en las trasparencias de José Luis Sierra y Juan Antonio Recio.}
\date{\today}

\begin{document}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\titlepage
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Índ.}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Índice}
	\tiny\tableofcontents
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Memoria}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Organización de la memoria}

\begin{itemize}[<+->]% makes it uncoverable
	\item Es posible acceder a los datos globales
	\item Desde cualquier registro de activación es necesario referir al registro de activación asociado con el bloque padre (que no tiene porque ser necesariamente el registro de activación anterior)
	\item Dos Posibles organizaciones:
		\begin{enumerate}[<+->]
			\item Enlaces estáticos
			\item Displays
		\end{enumerate}
\end{itemize}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Enlaces estáticos}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Enlaces estáticos}
\begin{itemize}
	\item En el registro de activación se incluye un enlace al registro de activación del bloque padre (enlace estático)
	\item La memoria se organiza en forma de pila de registros de activación, enlazados a través de los enlaces estáticos
\end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile] % fragile: needed for verbatim/lstlistings
\frametitle{Enlaces estáticos: Ejemplo}

\begin{columns}[T]
\column{.4\textwidth}
	\begin{lstlisting}[style=procesos]
	@red@proc proc1(){
	    x: num;
	    y: num;@
	    @vio@proc1();@
	@red@}@
	@blue@proc proc2(){
	    w: bool;
	    proc1();
	}@
	@green@main(){
	    a: bool;
	    proc2();
	}@
	\end{lstlisting}
\column{.3\textwidth}
	\tiny{Mem de instrucc.}
	\begin{tikzpicture}
	  \begin{scope}[every node/.style={draw, anchor=text, rectangle split,
	    rectangle split parts=12,minimum width=2cm,
	    rectangle split part fill={gray!20,red!40,red!40,red!40,violet!40,
	    blue!40,blue!40,blue!40,green!40,green!40,green!40,gray!20}}]
	    \node (Inst) at (2,4){
	    	\nodepart{one}...
	    	\nodepart{two}\small{def proc1()}
	    	\nodepart{three}\small{x: num}
	    	\nodepart{four}\small{y: num}
	    	\nodepart{five}\small{proc1()}
	    	\nodepart{six}\small{def proc2()}
	    	\nodepart{seven}\small{w: bool}
	    	\nodepart{eight}\small{proc1()}
	    	\nodepart{nine}\small{def main()}
	    	\nodepart{ten}\small{a: bool}
	    	\nodepart{eleven}\small{proc2()}
	    	\nodepart{twelve}...
	    };
	  \end{scope}
	\end{tikzpicture}
\column{.3\textwidth}
	\begin{center}
		\tiny{Pila de reg. de act.}
		\begin{tikzpicture}
		  \begin{scope}[every node/.style={draw, anchor=text, rectangle split,
		    rectangle split parts=10,minimum width=2cm,
		    rectangle split part fill={gray!20,violet!40,violet!40,violet!40,red!40,red!40,red!40,
		    blue!40,blue!40,green!40}}]
		    \node (Reg) at (2,4){
		    	\nodepart{one}...
		    	\nodepart{two}y
		    	\nodepart{three}x
		    	\nodepart{four}padre
		    	\nodepart{five}y
		    	\nodepart{six}x
		    	\nodepart{seven}padre
		        \nodepart{eight}w
		        \nodepart{nine}padre
		        \nodepart{ten}a
		    };
		  \end{scope}
		  \draw[-latex] (Reg.four west) to [out=225,in=135] (Reg.seven west);
		  \draw[-latex] (Reg.seven west) to [out=225,in=135] (Reg.nine west);
		  \draw[-latex] (Reg.nine west) to [out=225,in=135] (Reg.ten west);
		\end{tikzpicture}
	\end{center}
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Enlaces estáticos: Problemas}

\uncover<1->{¿Qué problemas hay?}

\begin{enumerate}
	\item<2-> La recuperación del enlace de un identificador global supone seguir toda la cadena de enlaces estáticos. Si el identificador ha sido declarado \emph{k} niveles por encima, es necesario realizar \emph{k} indirecciones hasta llegar al correspondiente registro de activación
	\item<3-> Hay que considerar la complejidad de generar código que gestione de manera adecuada los enlaces estáticos
\end{enumerate}

\uncover<4->{Solución:\\}
\uncover<5->{Almacenar los enlaces estáticos \emph{fuera} de los registros de activación. La estructura que los almacena se llama \textbf{display}.}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Displays}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Display}

\begin{itemize}[<+->]
	\item Secuencia de celdas consecutivas que apuntan a registros de activación
	\item La celda \emph{i} apunta al registro de activación que está siendo utilizado en el nivel de anidamiento \emph{i}
	\item Esta estructura facilita el acceso a los datos globales:\\
		el enlace para un identificador declarado en un bloque que se encuentra a profunidad \emph{i} estará en el registro de activación referido por la celda \emph{i} del display (el \emph{display i} a partir de ahora)
\end{itemize}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Display: Ejemplo}

\begin{columns}[T]
\column{.4\textwidth}
	\begin{lstlisting}[style=procesos]
	@red@proc proc1(){
	    x: num;
	    y: num;@
	    @vio@proc1();@
	@red@}@
	@blue@proc proc2(){
	    w: bool;
	    proc1();
	}@
	@green@main(){
	    a: bool;
	    proc2();
	}@
	\end{lstlisting}
\column{.6\textwidth}
	\begin{center}
		\begin{tikzpicture}
      [disp/.style={draw, rectangle, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2.8em},
      etq/.style={node distance=0pt, outer sep=0pt},
      stack/.style={draw, anchor=text, minimum width=2cm, node distance=0pt, outer sep=0pt, minimum height=1.5em}
      ]

	   	\node [minimum width=2cm, node distance=0pt, outer sep=0pt, minimum height=1.5em] at (4.5, -1.5) (regA) {};

      \uncover<-3>{\node [stack, below = of regA] (regB) {};}
      \uncover<4-4>{\node [stack, below = of regA, fill=violet!40] (regB) {y};}

      \uncover<-3>{\node [stack, below = of regB] (regC) {};}
      \uncover<4-4>{\node [stack, below = of regB, fill=violet!40] (regC) {x};}

      \uncover<-2>{\node [stack, below = of regC] (regD) {};}
      \uncover<3-5>{\node [stack, below = of regC, fill=red!40] (regD) {y};}

      \uncover<-2>{\node [stack, below = of regD] (regE) {};}
      \uncover<3-5>{\node [stack, below = of regD, fill=red!40] (regE) {x};}

      \uncover<-1>{\node [stack, below = of regE] (regF) {};}
      \uncover<2-6>{\node [stack, below = of regE, fill=blue!40] (regF) {w};}

      \node [stack, below = of regF, fill=green!40] (regG) {a};

		  \node [disp] (A) {0x09};
      \node [etq, above = of A] {\small{Disp0}};
		  \uncover<-1>{\node [disp, right = of A] (B) {null};}
      \uncover<2-6>{\node [disp, right = of A] (B) {0x13};}
      	  \uncover<7->{\node [disp, right = of A] (B) {null};}
      \node [etq, above = of B] {\small{Disp1}};
		  \uncover<-2>{\node [disp, right = of B] (C) {null};}
      \uncover<3-5>{\node [disp, right = of B] (C) {0x24};}
      	  \uncover<6->{\node [disp, right = of B] (C) {null};}
      \node [etq, above = of C] {\small{Disp2}};
      	  \uncover<-3>{\node [disp, right = of C] (D) {null};}
      \uncover<4-4>{\node [disp, right = of C] (D) {0x65};}
          \uncover<5->{\node [disp, right = of C] (D) {null};}
      \node [etq, above = of D] {\small{Disp3}};

		  \draw[-latex, dashed] ($(A.south)-(0.2,0)$) |- (regG.west);
		  \uncover<2-6>{\draw[-latex, dashed] ($(B.south)-(0.2,0)$) |- (regF.west);}
		  \uncover<3-5>{\draw[-latex, dashed] ($(C.south)-(0.2,0)$) |- (regE.west);}
		  \uncover<4-4>{\draw[-latex, dashed] ($(D.south)-(0.2,0)$) |- (regC.west);}
		\end{tikzpicture}
	\end{center}
\end{columns}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Nueva arquitect.}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Memoria}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Memoria de un programa I}

    \begin{tikzpicture}
        [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=4em}]

        \node[box, fill=red!40] at (0,0) (A) {CP};
        \node[box, right = of A, fill=green!40, minimum width=4em] (B) {Displays};
        \node[box, right = of B, text width=5em, align=center, fill=blue!40] (C) {Datos estáticos};
        \node[box, right = of C, minimum width=11em] (D) {\ldots};
        \node[box, right = of D, minimum width=3em, fill=lime!40] (E) {Heap};
        \node[box, right = of E] (F) {Code};

        \draw[-latex, thick] (C.east) -- ( $(C.east)!0.7cm!(D)$);
        \draw[-latex, thick] (E.west) -- ( $(E.west)!0.7cm!(D)$);

        \node[above = of A.north west, anchor=west, xshift=.5cm] (etqA) {0x0000000};
        \draw[-latex] (etqA.west) to [out=180, in=90] (A.north west);
        \node[above = of F.north east, anchor=east, xshift=-.5cm] (etqB) {0xFFFFFFFF};
        \draw[-latex] (etqB.east) to [out=0, in=90] (F.north east);

        \draw[-latex, dashed] (A.south) |- ($(C.south east)-(0.2,0.5)$) -- ($(C.south east)-(0.2,0)$);

    \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Memoria de un programa II}

Las primeras celdas de la memoria se destinarán a mantener la información de estado necesaria para gestionar adecuadamente la pila de registros de activación:
\begin{itemize}[<+->]
	\item Registro \emph{CP}: Contendrá siempre la dirección de la \textbf{última celda ocupada} por la pila de registros de activación (cuando la pila esté vacía, el valor de \emph{CP} será la dirección de la celda anterior: la última celda ocupada por los datos estáticos)
	\item \emph{Display}: Secuencia de celdas ocupadas por los displays.
\end{itemize}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Registros de activación}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Estructura de los Registros de activación}
    \begin{tikzpicture}
        [minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
        box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=4.2em, align=center}]

        \node[minibox, anchor=west, fill=red!40] at (0,1.5) (A) {\small{CP}};
        \node[minibox, right = of A, fill=green!40] (B) {\small{Displays}};
        \node[minibox, right = of B, text width=3.5em, align=center, fill=blue!40] (C) {\small{Datos estáticos}};
        \node[minibox, right = of C, text width=4em, align=center, fill=teal!40] (D) {\small{Reg. activación}};
        \node[minibox, right = of D, text width=4em, align=center, fill=teal!40] (E) {\small{Reg. activación}};
        \node[minibox, right = of E, minimum width=4em] (F) {};
        \node[minibox, right = of F, fill=lime!40] (G) {\small{Heap}};
        \node[minibox, right = of G] (H) {\small{Code}};

        \draw[-latex, thick] (E.east) -- ( $(E.east)!0.5cm!(F)$);
        \draw[-latex, thick] (G.west) -- ( $(G.west)!0.5cm!(F)$);

        \draw[-latex, dashed] (A.north) |- ($(E.north east)+(0,0.5)-(0.2,0)$) -- ($(E.north east)-(0.2,0)$);

        \node[box, anchor=west, text width=3em, fill=pink!40] at (0,-1.5) (rA) {Dir. retorno};
        \node[box, right = of rA, text width=3.3em, fill=pink!40] (rB) {Valor display antiguo};
        \node[box, right = of rB, fill=cyan!40] (rC) {Parám. 1};
        \node[box, right = of rC, text width=1em, fill=cyan!40] (rD) {\ldots};
        \node[box, right = of rD, fill=cyan!40] (rE) {Parám. $k$};
        \node[box, right = of rE, text width=3.3em, fill=cyan!40] (rF) {Variable local 1};
        \node[box, right = of rF, text width=1em, fill=cyan!40] (rG) {\ldots};
        \node[box, right = of rG, text width=3.3em, fill=cyan!40] (rH) {Variable local $q$};

        \draw (D.south west) -- ($(D.south west)-(0,0.2)$) -- (rA.north west);
        \draw (D.south east) -- ($(D.south east)-(0,0.2)$) -- (rH.north east);
    \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Organización de la traducción}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Esquema de la traducción de subprogramas}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Esquema de la traducción}

	\begin{tikzpicture}
	[minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
	box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center}]

		\node[minibox, fill=red!40] at (0,0) (A) {\small{CP}};
    \node[minibox, right = of A, fill=green!40] (B) {\small{Displays}};
    \node[minibox, right = of B, text width=3.5em, align=center, fill=blue!40] (C) {\small{Datos estáticos}};
    \node[minibox, right = of C, text width=4em, align=center, fill=teal!40] (D) {\small{Reg. activación}};
    \node[minibox, right = of D, text width=4em, align=center, fill=teal!40] (E) {\small{Reg. activación}};
    \node[minibox, right = of E, minimum width=4em] (F) {};
    \node[minibox, right = of F, fill=lime!40] (G) {\small{Heap}};
    \node[minibox, right = of G] (H) {\small{Code}};

    \draw[-latex, thick] (E.east) -- ( $(E.east)!0.5cm!(F)$);
    \draw[-latex, thick] (G.west) -- ( $(G.west)!0.5cm!(F)$);

  	\node[box, fill=gray!20, anchor=west] at (2,-1.5) (tA) {Inicio};
  	\node[box, below = of tA, minimum height=2em] (tB) {ir-a};
  	\node[box, below = of tB, minimum height=4em] (tC) {Traducción de subprogramas};
  	\node[box, below = of tC, minimum height=4em, fill=gray!20] (tD) {Traducción bloque principal};

  	\draw[-latex,dashed] (tB.east) -- ($(tB.east)+(0.5,0)$) -- ($(tD.north east)+(0.5,0)-(0,0.2)$) -- ($(tD.north east)-(0,0.2)$);

  	\draw (H.south west) to [out=270,in=0] (tA.north east);
  	\draw (H.south east) to [out=270,in=0] (tD.south east);
	\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Manejo de la activación y desactivación I}

	\begin{tikzpicture}
		[minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
		box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center}]

		\node (A) {Subprograma};
    \node[box, below = of A, fill=gray!20] (B) {Prólogo};
    \node[box, below = of B] (C) {Cuerpo};
    \node[box, below = of C, fill=gray!20] (D) {Epílogo};
    \node[box, below = of D] (E) {ir-ind};

    \node[below = of E] (F) {Main()};
    \node[box, below = of F, fill=gray!20] (G) {Prellamada};
    \node[box, below = of G] (H) {ir-a};
    \node[box, below = of H, fill=gray!20] (I) {Postllamada};

    \draw[-latex, dashed] (E.east) -- ($(E.east)+(0.5,0)$) -- ($(I.north east)+(0.5,0)-(0,0.1)$) -- ($(I.north east)-(0,0.1)$);
    \draw[-latex, dashed] (H.west) -- ($(H.west)-(0.5,0)$) -- ($(B.north west)-(0.5,0.1)$) --($(B.north west)-(0,0.1)$);

    \node[text width = 8em] at (6,-2.5) (explicacion) {ir-ind salta a la dirección indicada en la cima de la pila de evaluación, consumiendo dicha cima.\\PC $\leftarrow$ Pila[cima]\\cima $\leftarrow$ cima - 1};
	\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Manejo de la activación y desactivación II}

  \begin{tikzpicture}
    [minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
    box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center},
    tt/.style={node distance=7pt, outer sep=0pt, text width=10em, align=center}]

    \node (A) {Subprograma};
    \node[box, below = of A, fill=gray!20] (B) {Prólogo};
    \node[box, below = of B] (C) {Cuerpo};
    \node[box, below = of C, fill=gray!20] (D) {Epílogo};
    \node[box, below = of D] (E) {ir-ind};

    \node[below = of E] (F) {Main()};
    \node[box, below = of F, fill=gray!20] (G) {Prellamada};
    \node[box, below = of G] (H) {ir-a};
    \node[box, below = of H, fill=gray!20] (I) {Postllamada};

    \draw[-latex, dashed] (E.east) -- ($(E.east)+(0.5,0)$) -- ($(I.north east)+(0.5,0)-(0,0.1)$) -- ($(I.north east)-(0,0.1)$);
    \draw[-latex, dashed] (H.west) -- ($(H.west)-(0.5,0)$) -- ($(B.north west)-(0.5,0.1)$) --($(B.north west)-(0,0.1)$);

    \node[tt] at (6,-0.5) (tt1) {main: Prellamada};
    \node[tt, below = of tt1] (tt2) {ir-a};
    \node[tt, below = of tt2] (tt3) {Subprograma: Prólogo};
    \node[tt, below = of tt3] (tt4) {Subprograma: Cuerpo};
    \node[tt, below = of tt4] (tt5) {Subprograma: Epílogo};
    \node[tt, below = of tt5] (tt6) {ir-ind};
    \node[tt, below = of tt6] (tt7) {main: Postllamada};

    \draw[-latex] (tt1.south) -- (tt2.north);
    \draw[-latex] (tt2.south) -- (tt3.north);
    \draw[-latex] (tt3.south) -- (tt4.north);
    \draw[-latex] (tt4.south) -- (tt5.north);
    \draw[-latex] (tt5.south) -- (tt6.north);
    \draw[-latex] (tt6.south) -- (tt7.north);

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Ejemplo de invocación}

\begin{columns}[T]
\column{.5\textwidth}
\begin{lstlisting}[style=codigo]
	tipo tpar= rec x:num; y:num;
	@red@proc distanciaEuclidea(p1:tpar, p2:tpar, var res:num)
	    a: num; b: num;@
	    @blue@proc sumacuadrado(a:num, b:num, var r:num)
            a:=a*a;
	        b:=b*b
	        r:=a+b;@
	    @green@proc raizcuadrada(var n:num)
	        ...@
	    @red@&
	    a:=p1.x-p2.x;
	    b:=p1.y-p2.y;
	    sumacuadrado(a, b, res);
	    raizcuadrada(res);@
	par1:tpar; par2:tpar; resultado:num;
	&
	par1.x:=1; par1.y:=5;
	par2.x:=8; par2.y:=12;
	distanciaEuclidea(par1,par2,resultado);
\end{lstlisting}
\column{.5\textwidth}
	\uncover<2->{
			\Tree
			[.main()
			    [.{\color{red}distanciaEuclidea()}
			        [.{\color{blue}sumaCuadrado()}  ]
			        [.{\color{green}raizCuadrada()} ]
			    ]
			]
	}
\end{columns}
\uncover<1->{¿Cual es el máximo nivel de anidamiento para éste programa?}
\uncover<2->{2}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Inicio}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Inicio: Recapitulación}
  \begin{center}
	\begin{tikzpicture}
	[minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
	box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center}]

  	\node[box, fill=green!40, anchor=west] at (2,-1.5) (tA) {Inicio};
  	\node[box, below = of tA, minimum height=2em] (tB) {ir-a};
  	\node[box, below = of tB, minimum height=4em] (tC) {Traducción de subprogramas};
  	\node[box, below = of tC, minimum height=4em, fill=gray!20] (tD) {Traducción bloque principal};

  	\draw[-latex,dashed] (tB.east) -- ($(tB.east)+(0.5,0)$) -- ($(tD.north east)+(0.5,0)-(0,0.2)$) -- ($(tD.north east)-(0,0.2)$);

	\end{tikzpicture}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Inicio I}

\begin{itemize}
    \uncover<1->{\item Se fija el \emph{display 0} a la primera celda de datos estáticos}
    \uncover<2->{\item Se fija el \emph{CP} a la posición de la última celda ocupada por los datos estáticos.}
    \uncover<3->{\item Con ello se consigue un esquema homogéneo de direccionamiento de datos estáticos y de datos en los registros de activación}
\end{itemize}

  \begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=4em}]

      \node[box, fill=red!40] at (0,0) (A) {CP};
      \node[box, right = of A, fill=green!40, minimum width=4em] (B) {Displays};
      \node[box, right = of B, text width=5em, align=center, fill=blue!40] (C) {Datos estáticos};
      \node[box, right = of C, minimum width=11em] (D) {\ldots};
      \node[box, right = of D, minimum width=3em, fill=lime!40] (E) {Heap};
      \node[box, right = of E] (F) {Code};

      \draw[-latex, thick] (C.east) -- ( $(C.east)!0.7cm!(D)$);
      \draw[-latex, thick] (E.west) -- ( $(E.west)!0.7cm!(D)$);

      \uncover<1->{\draw[-latex, dashed] ($(B.south west)+(0.2,0)$) |- ($(C.south west)+(0.2,0)-(0,0.5)$) -- ($(C.south west)+(0.2,0)$);}
      \uncover<2->{\draw[-latex, dashed] (A.south) |- ($(C.south east)-(0.2,1)$) -- ($(C.south east)-(0.2,0)$);}

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Inicio II}
\begin{lstlisting}[style=codigoMP]
fun inicio(numNiveles,tamDatos) devuelve
   // fijamos display 0 a la 1a celda de datos estaticos:
   apila(numNiveles+2)           ||// +2: CP, display 0
   desapila-dir(0x1)             ||
   // fijamos CP a la ultima celda de datos estaticos:
   apila(1+numNiveles+tamDatos)  ||// +1: display 0
   desapila-dir(0x0)
ffun
cons longInicio = 4
\end{lstlisting}

Ejemplo: \textbf{inicio(2,5)}

  \begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2.2em, align=center}]

    \uncover<-2>{\node[box] at (0,0) (x0) {\tiny{?}};};
    \uncover<3->{\node[box, fill=red!40] at (0,0) (x0) {0x8};};

    \uncover<-1>{
      \node[box, right = of x0] (x1) {\tiny{?}};
      \node[box, right = of x1] (x2) {\tiny{?}};
      \node[box, right = of x2] (x3) {\tiny{?}};
      };
    \uncover<2->{
      \node[box, right = of x0, fill=green!40] (x1) {0x4};
      \node[box, right = of x1, fill=green!40] (x2) {\tiny{?}};
      \node[box, right = of x2, fill=green!40] (x3) {\tiny{?}};
      };

    \uncover<-2>{
      \node[box, right = of x3] (x4) {\tiny{?}};
      \node[box, right = of x4] (x5) {\tiny{?}};
      \node[box, right = of x5] (x6) {\tiny{?}};
      \node[box, right = of x6] (x7) {\tiny{?}};
      \node[box, right = of x7] (x8) {\tiny{?}};
      };
    \uncover<3->{
      \node[box, right = of x3, fill=blue!40] (x4) {\tiny{?}};
      \node[box, right = of x4, fill=blue!40] (x5) {\tiny{?}};
      \node[box, right = of x5, fill=blue!40] (x6) {\tiny{?}};
      \node[box, right = of x6, fill=blue!40] (x7) {\tiny{?}};
      \node[box, right = of x7, fill=blue!40] (x8) {\tiny{?}};
      };

    \node[box, right = of x8] (x9) {\tiny{?}};
    \node[box, right = of x9] (x10) {\tiny{?}};
    \node[box, right = of x10] (x11) {\tiny{?}};
    \node[box, right = of x11] (x12) {\ldots};

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};

    \uncover<2->{\draw[-latex, dashed] (x1.south) -- ($(x1.south)-(0,0.2)$) -- ($(x4.south)-(0,0.2)$) -- (x4.south);};
    \uncover<3->{\draw[-latex, dashed] (x0.south) -- ($(x0.south)-(0,0.5)$) -- ($(x8.south)-(0,0.5)$) -- (x8.south);};

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Prellamada}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prellamada: Recapitulación}

  \begin{tikzpicture}
    [minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
    box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center},
    tt/.style={node distance=7pt, outer sep=0pt, text width=10em, align=center}]

    \node (A) {Subprograma};
    \node[box, below = of A, fill=gray!20] (B) {Prólogo};
    \node[box, below = of B] (C) {Cuerpo};
    \node[box, below = of C, fill=gray!20] (D) {Epílogo};
    \node[box, below = of D] (E) {ir-ind};

    \node[below = of E] (F) {Main()};
    \node[box, below = of F, fill=green!40] (G) {Prellamada};
    \node[box, below = of G] (H) {ir-a};
    \node[box, below = of H, fill=gray!20] (I) {Postllamada};

    \draw[-latex, dashed] (E.east) -- ($(E.east)+(0.5,0)$) -- ($(I.north east)+(0.5,0)-(0,0.1)$) -- ($(I.north east)-(0,0.1)$);
    \draw[-latex, dashed] (H.west) -- ($(H.west)-(0.5,0)$) -- ($(B.north west)-(0.5,0.1)$) --($(B.north west)-(0,0.1)$);

    \node[tt] at (6,-0.5) (tt1) {\color{green}{main: Prellamada}};
    \node[tt, below = of tt1] (tt2) {ir-a};
    \node[tt, below = of tt2] (tt3) {Subprograma: Prólogo};
    \node[tt, below = of tt3] (tt4) {Subprograma: Cuerpo};
    \node[tt, below = of tt4] (tt5) {Subprograma: Epílogo};
    \node[tt, below = of tt5] (tt6) {ir-ind};
    \node[tt, below = of tt6] (tt7) {main: Postllamada};

    \draw[-latex] (tt1.south) -- (tt2.north);
    \draw[-latex] (tt2.south) -- (tt3.north);
    \draw[-latex] (tt3.south) -- (tt4.north);
    \draw[-latex] (tt4.south) -- (tt5.north);
    \draw[-latex] (tt5.south) -- (tt6.north);
    \draw[-latex] (tt6.south) -- (tt7.north);

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prellamada}

Asociada con la invocación $p(e_1,...,e_k)$:
\begin{enumerate}[<+->]
	\item Guardar en memoria la direccion de retorno
    \item Evaluar y almacenar parámetros de ejecución del procedimiento (por ahora nos olvidamos)
    \item Saltar a la dirección de inicio del procedimiento (\emph{ir-a})
\end{enumerate}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prellamada: Ejemplo}

\begin{lstlisting}[style=codigoMP]
fun apila-ret(ret) devuelve
   // calcular CP+1:
   apila-dir(0x0)        ||
   apila(1)              ||
   suma                  ||
   // guardar dir retorno:
   apila(ret)            ||
   desapila-ind          ||
ffun
cons longApilaRet = 5
\end{lstlisting}

Ejemplo: \textbf{apila-ret(0x87)} , siendo 0x87 el nº de instrucción.

  \begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2em, align=center}]

    \node[box, fill=red!40] at (0,0) (x0) {0x8};

    \node[box, right = of x0, fill=green!40] (x1) {\small{0x4}};
    \node[box, right = of x1, fill=green!40] (x2) {\tiny{?}};
    \node[box, right = of x2, fill=green!40] (x3) {\tiny{?}};

    \node[box, right = of x3, fill=blue!40, minimum width=2em] (x4) {\tiny{?}};
    \node[box, right = of x4, fill=blue!40, minimum width=2em] (x5) {\tiny{?}};
    \node[box, right = of x5, fill=blue!40, minimum width=2em] (x6) {\tiny{?}};
    \node[box, right = of x6, fill=blue!40, minimum width=2em] (x7) {\tiny{?}};
    \node[box, right = of x7, fill=blue!40, minimum width=2em] (x8) {\tiny{?}};

    \uncover<-1>{\node[box, right = of x8, minimum width=2.48em] (x9) {\tiny{?}};};
    \uncover<2->{\node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};};
    \node[box, right = of x9] (x10) {\tiny{?}};
    \node[box, right = of x10] (x11) {\tiny{?}};
    \node[box, right = of x11] (x12) {\tiny{?}};
    \node[box, right = of x12] (x13) {\ldots};

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};

    \draw[-latex, dashed] (x1.south) -- ($(x1.south)-(0,0.2)$) -- ($(x4.south)-(0,0.2)$) -- (x4.south);
    \draw[-latex, dashed] (x0.south) -- ($(x0.south)-(0,0.5)$) -- ($(x8.south)-(0,0.5)$) -- (x8.south);

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Prólogo}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prólogo: Recapitulación}

\begin{tikzpicture}
    [minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
    box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center},
    tt/.style={node distance=7pt, outer sep=0pt, text width=10em, align=center}]

    \node (A) {Subprograma};
    \node[box, below = of A, fill=green!40] (B) {Prólogo};
    \node[box, below = of B] (C) {Cuerpo};
    \node[box, below = of C, fill=gray!20] (D) {Epílogo};
    \node[box, below = of D] (E) {ir-ind};

    \node[below = of E] (F) {Main()};
    \node[box, below = of F, fill=gray!20] (G) {Prellamada};
    \node[box, below = of G] (H) {ir-a};
    \node[box, below = of H, fill=gray!20] (I) {Postllamada};

    \draw[-latex, dashed] (E.east) -- ($(E.east)+(0.5,0)$) -- ($(I.north east)+(0.5,0)-(0,0.1)$) -- ($(I.north east)-(0,0.1)$);
    \draw[-latex, dashed] (H.west) -- ($(H.west)-(0.5,0)$) -- ($(B.north west)-(0.5,0.1)$) --($(B.north west)-(0,0.1)$);

    \node[tt] at (6,-0.5) (tt1) {main: Prellamada};
    \node[tt, below = of tt1] (tt2) {ir-a};
    \node[tt, below = of tt2] (tt3) {\color{green}{Subprograma: Prólogo}};
    \node[tt, below = of tt3] (tt4) {Subprograma: Cuerpo};
    \node[tt, below = of tt4] (tt5) {Subprograma: Epílogo};
    \node[tt, below = of tt5] (tt6) {ir-ind};
    \node[tt, below = of tt6] (tt7) {main: Postllamada};

    \draw[-latex] (tt1.south) -- (tt2.north);
    \draw[-latex] (tt2.south) -- (tt3.north);
    \draw[-latex] (tt3.south) -- (tt4.north);
    \draw[-latex] (tt4.south) -- (tt5.north);
    \draw[-latex] (tt5.south) -- (tt6.north);
    \draw[-latex] (tt6.south) -- (tt7.north);

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prólogo I}

Asociado con el prodecimiento $proc \ p(...)$:
\begin{enumerate}[<+->]
	\item Guardar el antiguo valor del display
    \item Actualizar el valor nuevo del display
    \item Reservar espacio para las variables locales
\end{enumerate}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prólogo II}

\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily]
fun prologo(nivel,tamlocales) devuelve
   // salvar display antiguo:
   apila-dir(0x0)          ||
   apila(2)                ||
   suma                    ||
   apila-dir(0x1+nivel)    ||
   desapila-ind            ||
   // fijar el display actual:
   apila-dir(0x0)          ||
   apila(3)                ||
   suma                    ||
   desapila-dir(0x1+nivel) ||
   // reservar espacio para datos locales:
   apila-dir(0x0)          ||
   apila(tamlocales+2)     ||
   suma                    ||
   desapila-dir(0x0)
ffun
cons longPrologo = 13
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prólogo: Ejemplo I}

\begin{lstlisting}[style=codigoMP,basicstyle=\tiny\ttfamily]
fun prologo(nivel,tamlocales) devuelve
   // salvar display antiguo:
   @b@apila-dir(0x0)          ||@
   @b@apila(2)                ||@ // dir. retorno, antiguo display
   @b@suma                    ||@
   @b@apila-dir(0x1+nivel)    ||@ // +1: saltar al display 0
   @b@desapila-ind            ||@
   // fijar el display actual:
   apila-dir(0x0)             ||
   apila(3)                   ||
   suma                       ||
   desapila-dir(0x1+nivel)    ||
   // reservar espacio para datos locales:
   apila-dir(0x0)             ||
   apila(tamlocales+2)        ||
   suma                       ||
   desapila-dir(0x0)
ffun
\end{lstlisting}

Ejemplo: \textbf{prologo(1,7)}

  \begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2em, align=center}]

    \node[box, fill=red!40] at (0,0) (x0) {\small{0x8}};

    \node[box, right = of x0, fill=green!40] (x1) {\small{0x4}};
    \node[box, right = of x1, fill=green!40, minimum width=2.5em] (x2) {\small{¿?}};
    \node[box, right = of x2, fill=green!40] (x3) {\tiny{?}};

    \node[box, right = of x3, fill=blue!40, minimum width=2em] (x4) {\tiny{?}};
    \node[box, right = of x4, fill=blue!40, minimum width=2em] (x5) {\tiny{?}};
    \node[box, right = of x5, fill=blue!40, minimum width=2em] (x6) {\tiny{?}};
    \node[box, right = of x6, fill=blue!40, minimum width=2em] (x7) {\tiny{?}};
    \node[box, right = of x7, fill=blue!40, minimum width=2em] (x8) {\tiny{?}};

    \node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
    \uncover<-1>{\node[box, right = of x9] (x10) {\tiny{?}};};
    \uncover<2->{\node[box, right = of x9, fill=pink!40] (x10) {\small{¿?}};};
    \node[box, right = of x10] (x11) {\tiny{?}};
    \node[box, right = of x11] (x12) {\tiny{?}};
    \node[box, right = of x12] (x13) {\ldots};

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};

    \uncover<2->{\draw[-latex] (x2.south) -- ($(x2.south)-(0,0.4)$) -- ($(x10.south)-(0,0.4)$) -- (x10.south);};

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prólogo: Ejemplo II}

\begin{lstlisting}[style=codigoMP,basicstyle=\tiny\ttfamily]
fun prologo(nivel,tamlocales) devuelve
   // salvar display antiguo:
   apila-dir(0x0)             ||
   apila(2)                   ||
   suma                       ||
   apila-dir(0x1+nivel)       ||
   desapila-ind               ||
   // fijar el display actual:
   @b@apila-dir(0x0)          ||@
   @b@apila(3)                ||@
   @b@suma                    ||@
   @b@desapila-dir(0x1+nivel) ||@
   // reservar espacio para datos locales:
   apila-dir(0x0)             ||
   apila(tamlocales+2)        ||
   suma                       ||
   desapila-dir(0x0)
ffun
\end{lstlisting}

Ejemplo: \textbf{prologo(1,7)}

  \begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2em, align=center}]

    \node[box, fill=red!40] at (0,0) (x0) {\small{0x8}};

    \node[box, right = of x0, fill=green!40] (x1) {\small{0x4}};
    \uncover<-1>{\node[box, right = of x1, fill=green!40, minimum width=2.5em] (x2) {\small{¿?}};};
    \uncover<2->{\node[box, right = of x1, fill=green!40] (x2) {\small{0x11}};};
    \node[box, right = of x2, fill=green!40] (x3) {\tiny{?}};

    \node[box, right = of x3, fill=blue!40, minimum width=2em] (x4) {\tiny{?}};
    \node[box, right = of x4, fill=blue!40, minimum width=2em] (x5) {\tiny{?}};
    \node[box, right = of x5, fill=blue!40, minimum width=2em] (x6) {\tiny{?}};
    \node[box, right = of x6, fill=blue!40, minimum width=2em] (x7) {\tiny{?}};
    \node[box, right = of x7, fill=blue!40, minimum width=2em] (x8) {\tiny{?}};

    \node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
    \node[box, right = of x9, fill=pink!40] (x10) {\small{¿?}};
    \node[box, right = of x10] (x11) {\tiny{?}};
    \node[box, right = of x11] (x12) {\tiny{?}};
    \node[box, right = of x12] (x13) {\ldots};

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x11] (etq11) {\small{11}};
    \node[box, draw=none, above = of x12] {\small{12}};

    \uncover<2->{\draw[-latex, dashed] ($(etq11.south)+(0,0.2)$) -- ($(x11.south)-(0,0.4)$) -- ($(x2.south)-(0,0.4)$) -- (x2.south);};

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Prólogo: Ejemplo III}

\begin{lstlisting}[style=codigoMP,basicstyle=\tiny\ttfamily]
fun prologo(nivel,tamlocales) devuelve
   // salvar display antiguo:
   apila-dir(0x0)          ||
   apila(2)                ||
   suma                    ||
   apila-dir(0x1+nivel)    ||
   desapila-ind            ||
   // fijar el display actual:
   apila-dir(0x0)          ||
   apila(3)                ||
   suma                    ||
   desapila-dir(0x1+nivel) ||
   // reservar espacio para datos locales:
   @b@apila-dir(0x0)       ||@ // Mem[1+nivel] = Pila[Cima]
   @b@apila(tamlocales+2)  ||@ // +2: dir. retorno, antiguo display
   @b@suma                 ||@
   @b@desapila-dir(0x0)      @
ffun
\end{lstlisting}

Ejemplo: \textbf{prologo(1,7)}

	\begin{tikzpicture}[box/.style={draw, node distance=0pt, outer sep=0pt,
	minimum height=2em, minimum width=2em, align=center},short/.style={minimum width = 1.8em}]

    \uncover<-1>{\node[box, fill=red!40, minimum width=2.49em] at (0,0) (x0) {\small{0x8}};};
    \uncover<2->{\node[box, fill=red!40] at (0,0) (x0) {\small{0x17}};};

    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {\small{0x4}};
    \node[box, right = of x1, fill=green!40, minimum width=1.5em] (x2) {\small{0x11}};
    \node[box, right = of x2, fill=green!40, minimum width=1.5em] (x3) {\tiny{?}};


		\node[box, right = of x3, fill=blue!40, minimum width=1em] (x4) {\tiny{?}};
		\node[box, right = of x4, fill=blue!40, minimum width=1em] (x5) {\tiny{?}};
		\node[box, right = of x5, fill=blue!40, minimum width=1em] (x6) {\tiny{?}};
		\node[box, right = of x6, fill=blue!40, minimum width=1em] (x7) {\tiny{?}};
		\node[box, right = of x7, fill=blue!40, minimum width=1em] (x8) {\tiny{?}};

    \node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
    \node[box, right = of x9, fill=pink!40] (x10) {\small{¿?}};

    \uncover<-1>{
      \node[box, short, right = of x10, minimum width=1.2em] (x11) {\tiny{?}};
      \node[box, short, right = of x11, minimum width=1.2em] (x12) {\tiny{?}};
      \node[box, short, right = of x12, minimum width=1.2em] (x13) {\tiny{?}};
      \node[box, short, right = of x13, minimum width=1.2em] (x14) {\tiny{?}};
      \node[box, short, right = of x14, minimum width=1.2em] (x15) {\tiny{?}};
      \node[box, short, right = of x15, minimum width=1.2em] (x16) {\tiny{?}};
      \node[box, short, right = of x16, minimum width=1.2em] (x17) {\tiny{?}};
      };
    \uncover<2->{
      \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {\tiny{?}};
      \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {\tiny{?}};
      \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\tiny{?}};
      \node[box, short, right = of x13, fill=cyan!40, minimum width=1.2em] (x14) {\tiny{?}};
      \node[box, short, right = of x14, fill=cyan!40, minimum width=1.2em] (x15) {\tiny{?}};
      \node[box, short, right = of x15, fill=cyan!40, minimum width=1.2em] (x16) {\tiny{?}};
      \node[box, short, right = of x16, fill=cyan!40, minimum width=1.2em] (x17) {\tiny{?}};
      };

    \node[box, short, right = of x17] (x18) {\ldots};

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};
    \node[box, draw=none, above = of x14] {\small{14}};
    \node[box, draw=none, above = of x16] {\small{16}};
    \node[box, draw=none, above = of x18] {\small{18}};

    \uncover<2->{
      \draw[-latex, dashed] (x0.south) -- ($(x0.south)-(0,0.4)$) -- ($(x17.south)-(0,0.4)$) -- (x17.south);
    };

	\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Epílogo}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Epílogo: Recapitulación}

\begin{tikzpicture}
    [minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
    box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center},
    tt/.style={node distance=7pt, outer sep=0pt, text width=10em, align=center}]

    \node (A) {Subprograma};
    \node[box, below = of A, fill=gray!20] (B) {Prólogo};
    \node[box, below = of B] (C) {Cuerpo};
    \node[box, below = of C, fill=green!40] (D) {Epílogo};
    \node[box, below = of D] (E) {ir-ind};

    \node[below = of E] (F) {Main()};
    \node[box, below = of F, fill=gray!20] (G) {Prellamada};
    \node[box, below = of G] (H) {ir-a};
    \node[box, below = of H, fill=gray!20] (I) {Postllamada};

    \draw[-latex, dashed] (E.east) -- ($(E.east)+(0.5,0)$) -- ($(I.north east)+(0.5,0)-(0,0.1)$) -- ($(I.north east)-(0,0.1)$);
    \draw[-latex, dashed] (H.west) -- ($(H.west)-(0.5,0)$) -- ($(B.north west)-(0.5,0.1)$) --($(B.north west)-(0,0.1)$);

    \node[tt] at (6,-0.5) (tt1) {main: Prellamada};
    \node[tt, below = of tt1] (tt2) {ir-a};
    \node[tt, below = of tt2] (tt3) {Subprograma: Prólogo};
    \node[tt, below = of tt3] (tt4) {Subprograma: Cuerpo};
    \node[tt, below = of tt4] (tt5) {\color{green}{Subprograma: Epílogo}};
    \node[tt, below = of tt5] (tt6) {ir-ind};
    \node[tt, below = of tt6] (tt7) {main: Postllamada};

    \draw[-latex] (tt1.south) -- (tt2.north);
    \draw[-latex] (tt2.south) -- (tt3.north);
    \draw[-latex] (tt3.south) -- (tt4.north);
    \draw[-latex] (tt4.south) -- (tt5.north);
    \draw[-latex] (tt5.south) -- (tt6.north);
    \draw[-latex] (tt6.south) -- (tt7.north);

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Epílogo I}

Asociado con el prodecimiento $proc \ p(...)$:
\begin{itemize}[<+->]
	\item Almacenar el valor devuelto por la función (en nuestro caso no se hace, no tenemos funciones)
\end{itemize}
\begin{enumerate}[<+->]
    \item Liberar el espacio utilizado por las variables locales (mover hacia atrás el CP)
    \item Restaurar el antiguo display
    \item Apilar la dirección de retorno y saltar usando \emph{ir-ind}
\end{enumerate}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Epílogo II}
\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily]
fun epilogo(nivel) devuelve
   // apilar la dir. retorno:
   apila-dir(0X1+nivel)    ||
   apila(2)                ||
   resta                   ||
   apila-ind               ||
   // liberar espacio (mover CP):
   apila-dir(0x1+nivel)    ||
   apila(3)                ||
   resta                   ||
   copia                   ||
   desapila-dir(0x0)       ||
   // recuperar antiguo display:
   apila(2)                ||
   suma                    ||
   apila-ind               ||
   desapila-dir(0x1+nivel)
ffun
cons longEpilogo = 13
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Epílogo: Ejemplo I}

\begin{lstlisting}[style=codigoMP,basicstyle=\tiny\ttfamily]
fun epilogo(nivel) devuelve
   // apilar la dir. retorno:
   @b@apila-dir(0x1+nivel)    ||@
   @b@apila(2)                ||@
   @b@resta                   ||@
   @b@apila-ind               ||@
   // liberar espacio (mover CP):
   apila-dir(0x1+nivel)      ||
   apila(3)                  ||
   resta                     ||
   copia                     ||
   desapila-dir(0x0)         ||
   // recuperar antiguo display:
   apila(2)                  ||
   suma                      ||
   apila-ind                 ||
   desapila-dir(0x1+nivel)
ffun
\end{lstlisting}

Ejemplo: \textbf{epilogo(1)}

\begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2.7em, align=center},
      short/.style={minimum width = 1.8em}]

    \node[box, fill=red!40] at (0,0) (x0) {\small{0x17}};

    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {\small{0x4}};
    \node[box, right = of x1, fill=green!40, minimum width=1.5em] (x2) {\small{0x11}};
    \node[box, right = of x2, fill=green!40, minimum width=1.5em] (x3) {\tiny{?}};


    \node[box, right = of x3, fill=blue!40, minimum width=1em] (x4) {\tiny{?}};
    \node[box, right = of x4, fill=blue!40, minimum width=1em] (x5) {\tiny{?}};
    \node[box, right = of x5, fill=blue!40, minimum width=1em] (x6) {\tiny{?}};
    \node[box, right = of x6, fill=blue!40, minimum width=1em] (x7) {\tiny{?}};
    \node[box, right = of x7, fill=blue!40, minimum width=1em] (x8) {\tiny{?}};


    \node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
    \node[box, right = of x9, fill=pink!40] (x10) {\small{¿?}};

    \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {\tiny{?}};
    \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {\tiny{?}};
    \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\tiny{?}};
    \node[box, short, right = of x13, fill=cyan!40, minimum width=1.2em] (x14) {\tiny{?}};
    \node[box, short, right = of x14, fill=cyan!40, minimum width=1.2em] (x15) {\tiny{?}};
    \node[box, short, right = of x15, fill=cyan!40, minimum width=1.2em] (x16) {\tiny{?}};
    \node[box, short, right = of x16, fill=cyan!40, minimum width=1.2em] (x17) {\tiny{?}};

    \node[box, short, right = of x17] (x18) {\ldots};

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};
    \node[box, draw=none, above = of x14] {\small{14}};
    \node[box, draw=none, above = of x16] {\small{16}};
    \node[box, draw=none, above = of x18] {\small{18}};

    \uncover<2->{
      \draw[-latex] (x9.south) -- ($(x9.south)-(0,0.45)$) -- ($(x10.south east)-(0.1,0.45)$);
      \node[box, draw=none, below =0.1 of x14] {Pila de evaluación};
    };

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Epílogo: Ejemplo II}

\begin{lstlisting}[style=codigoMP,basicstyle=\tiny\ttfamily]
fun epilogo(nivel) devuelve
   // apilar la dir. retorno:
   apila-dir(0x1+nivel)      ||
   apila(2)                  ||
   resta                     ||
   apila-ind                 ||
   // liberar espacio (mover CP):
   @b@apila-dir(0x1+nivel)   ||@
   @b@apila(3)               ||@
   @b@resta                  ||@
   @b@copia                  ||@ // si no se usa copia, hay que mover CP lo ultimo
   @b@desapila-dir(0x0)      ||@
   // recuperar antiguo display:
   apila(2)                  ||
   suma                      ||
   apila-ind                 ||
   desapila-dir(0x1+nivel)
ffun
\end{lstlisting}

¿Es esta la mejor forma de implementar el epílogo? ¿Moviendo el CP en 2º lugar?

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Epílogo: Ejemplo II}

\begin{lstlisting}[style=codigoMP,basicstyle=\tiny\ttfamily]
fun epilogo(nivel) devuelve
   // apilar la dir. retorno:
   apila-dir(0x1+nivel)      ||
   apila(2)                  ||
   resta                     ||
   apila-ind                 ||
   // liberar espacio (mover CP):
   @b@apila-dir(0x1+nivel)   ||@
   @b@apila(3)               ||@
   @b@resta                  ||@
   @b@copia                  ||@ // si no se usa copia, hay que mover CP lo ultimo
   @b@desapila-dir(0x0)      ||@
   // recuperar antiguo display:
   apila(2)                  ||
   suma                      ||
   apila-ind                 ||
   desapila-dir(0x1+nivel)
ffun
\end{lstlisting}

Ejemplo: \textbf{epilogo(1)}

\begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2em, align=center},
      short/.style={minimum width = 1.8em}]

    \uncover<-1>{\node[box, fill=red!40] at (0,0) (x0) {\small{0x17}};};
    \uncover<2->{\node[box, fill=red!40, minimum width=2.5em] at (0,0) (x0) {\small{0x8}};};

    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {\small{0x4}};
    \node[box, right = of x1, fill=green!40, minimum width=1.5em] (x2) {\small{0x11}};
    \node[box, right = of x2, fill=green!40, minimum width=1.5em] (x3) {\tiny{?}};


    \node[box, right = of x3, fill=blue!40, minimum width=1em] (x4) {\tiny{?}};
    \node[box, right = of x4, fill=blue!40, minimum width=1em] (x5) {\tiny{?}};
    \node[box, right = of x5, fill=blue!40, minimum width=1em] (x6) {\tiny{?}};
    \node[box, right = of x6, fill=blue!40, minimum width=1em] (x7) {\tiny{?}};
    \node[box, right = of x7, fill=blue!40, minimum width=1em] (x8) {\tiny{?}};

    \uncover<-1>{
      \node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
      \node[box, right = of x9, fill=pink!40] (x10) {\small{¿?}};
      \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {\tiny{?}};
      \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {\tiny{?}};
      \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\tiny{?}};
      \node[box, short, right = of x13, fill=cyan!40, minimum width=1.2em] (x14) {\tiny{?}};
      \node[box, short, right = of x14, fill=cyan!40, minimum width=1.2em] (x15) {\tiny{?}};
      \node[box, short, right = of x15, fill=cyan!40, minimum width=1.2em] (x16) {\tiny{?}};
      \node[box, short, right = of x16, fill=cyan!40, minimum width=1.2em] (x17) {\tiny{?}};
      };
    \uncover<2->{
      \node[box, right = of x8] (x9) {\small{0x87}};
      \node[box, right = of x9] (x10) {\small{¿?}};
      \node[box, short, right = of x10, minimum width=1.2em] (x11) {\tiny{?}};
      \node[box, short, right = of x11, minimum width=1.2em] (x12) {\tiny{?}};
      \node[box, short, right = of x12, minimum width=1.2em] (x13) {\tiny{?}};
      \node[box, short, right = of x13, minimum width=1.2em] (x14) {\tiny{?}};
      \node[box, short, right = of x14, minimum width=1.2em] (x15) {\tiny{?}};
      \node[box, short, right = of x15, minimum width=1.2em] (x16) {\tiny{?}};
      \node[box, short, right = of x16, minimum width=1.2em] (x17) {\tiny{?}};
      };

    \node[box, short, right = of x17] (x18) {\ldots};

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};
    \node[box, draw=none, above = of x14] {\small{14}};
    \node[box, draw=none, above = of x16] {\small{16}};
    \node[box, draw=none, above = of x18] {\small{18}};

    \uncover<2->{
      \draw[-latex, dashed] (x0.south) -- ($(x0.south)-(0,0.4)$) -- ($(x8.south)-(0,0.4)$) -- (x8.south);
    };

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Epílogo: Ejemplo III}

\begin{lstlisting}[style=codigoMP,basicstyle=\tiny\ttfamily]
fun epilogo(nivel) devuelve
   // apilar la dir. retorno:
   apila-dir0x1+nivel)        ||
   apila(2)                   ||
   resta                      ||
   apila-ind                  ||
   // liberar espacio (mover CP):
   apila-dir(0x1+nivel)       ||
   apila(3)                   ||
   resta                      ||
   copia                      ||
   desapila-dir(0x0)          ||
   // recuperar antiguo display:
   @b@apila(2)                ||@
   @b@suma                    ||@
   @b@apila-ind               ||@
   @b@desapila-dir(0x1+nivel)   @
ffun
\end{lstlisting}

Ejemplo: \textbf{epilogo(1)}

  \begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2em, align=center},
      short/.style={minimum width = 1.8em}]

    \node[box, fill=red!40, minimum width=2.5em] at (0,0) (x0) {\small{0x8}};

    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {\small{0x4}};

    \uncover<-1>{\node[box, right = of x1, fill=green!40, minimum width=2.5em] (x2) {\small{0x11}};};
    \uncover<2->{\node[box, right = of x1, fill=green!40, minimum width=2.5em] (x2) {\small{¿?}};};

    \node[box, right = of x2, fill=green!40, minimum width=1.5em] (x3) {\tiny{?}};


    \node[box, right = of x3, fill=blue!40, minimum width=1em] (x4) {\tiny{?}};
    \node[box, right = of x4, fill=blue!40, minimum width=1em] (x5) {\tiny{?}};
    \node[box, right = of x5, fill=blue!40, minimum width=1em] (x6) {\tiny{?}};
    \node[box, right = of x6, fill=blue!40, minimum width=1em] (x7) {\tiny{?}};
    \node[box, right = of x7, fill=blue!40, minimum width=1em] (x8) {\tiny{?}};

    \node[box, right = of x8] (x9) {\small{0x87}};
    \node[box, right = of x9] (x10) {\small{¿?}};
    \node[box, short, right = of x10, minimum width=1.2em] (x11) {\tiny{?}};
    \node[box, short, right = of x11, minimum width=1.2em] (x12) {\tiny{?}};
    \node[box, short, right = of x12, minimum width=1.2em] (x13) {\tiny{?}};
    \node[box, short, right = of x13, minimum width=1.2em] (x14) {\tiny{?}};
    \node[box, short, right = of x14, minimum width=1.2em] (x15) {\tiny{?}};
    \node[box, short, right = of x15, minimum width=1.2em] (x16) {\tiny{?}};
    \node[box, short, right = of x16, minimum width=1.2em] (x17) {\tiny{?}};

    \node[box, short, right = of x17] (x18) {\ldots};

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};
    \node[box, draw=none, above = of x14] {\small{14}};
    \node[box, draw=none, above = of x16] {\small{16}};
    \node[box, draw=none, above = of x18] {\small{18}};

  \uncover<2->{\draw[-latex] (x10.south) -- ($(x10.south)-(0,0.4)$) -- ($(x2.south)-(0,0.4)$) -- (x2.south);};

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Postllamada}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Postllamada: Recapitulación}

\begin{tikzpicture}
    [minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
    box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center},
    tt/.style={node distance=7pt, outer sep=0pt, text width=10em, align=center}]

    \node (A) {Subprograma};
    \node[box, below = of A, fill=gray!20] (B) {Prólogo};
    \node[box, below = of B] (C) {Cuerpo};
    \node[box, below = of C, fill=gray!20] (D) {Epílogo};
    \node[box, below = of D] (E) {ir-ind};

    \node[below = of E] (F) {Main()};
    \node[box, below = of F, fill=gray!20] (G) {Prellamada};
    \node[box, below = of G] (H) {ir-a};
    \node[box, below = of H, fill=green!40] (I) {Postllamada};

    \draw[-latex, dashed] (E.east) -- ($(E.east)+(0.5,0)$) -- ($(I.north east)+(0.5,0)-(0,0.1)$) -- ($(I.north east)-(0,0.1)$);
    \draw[-latex, dashed] (H.west) -- ($(H.west)-(0.5,0)$) -- ($(B.north west)-(0.5,0.1)$) --($(B.north west)-(0,0.1)$);

    \node[tt] at (6,-0.5) (tt1) {main: Prellamada};
    \node[tt, below = of tt1] (tt2) {ir-a};
    \node[tt, below = of tt2] (tt3) {Subprograma: Prólogo};
    \node[tt, below = of tt3] (tt4) {Subprograma: Cuerpo};
    \node[tt, below = of tt4] (tt5) {Subprograma: Epílogo};
    \node[tt, below = of tt5] (tt6) {ir-ind};
    \node[tt, below = of tt6] (tt7) {\color{green}{main: Postllamada}};

    \draw[-latex] (tt1.south) -- (tt2.north);
    \draw[-latex] (tt2.south) -- (tt3.north);
    \draw[-latex] (tt3.south) -- (tt4.north);
    \draw[-latex] (tt4.south) -- (tt5.north);
    \draw[-latex] (tt5.south) -- (tt6.north);
    \draw[-latex] (tt6.south) -- (tt7.north);

  \end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Postllamada}

No es necesaria en nuestra implementación:
\begin{itemize}[<+->]
	\item El epílogo recupera el estado anterior a la invocación
	\item El epílogo termina y deja la dirección (indirecta) de retorno en la cima de la pila
\end{itemize}
\uncover<+->{En otras arquitecturas:}
\begin{itemize}[<+->]
	\item Soportan funciones con retorno de valor: copiar el valor devuelto por la función donde sea necesario
	\item $x86,x86\_64,ARM$ \ldots: restaurar el estado (registros, diferentes punteros)\ldots
\end{itemize}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Resumen}
  \begin{center}
	\begin{tikzpicture}
		[minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
		box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=13em, text width=8em,align=center}]

		\node (A) {Subprograma};
    \node[box, below = of A, fill=gray!20] (B) {Prólogo};
    \node[box, below = of B] (C) {Cuerpo};
    \node[box, below = of C, fill=gray!20] (D) {Epílogo};
    \node[box, below = of D] (E) {ir-ind};

    \node[below = of E] (F) {Main()};
    \node[box, below = of F, fill=gray!20] (G) {Prellamada};
    \node[box, below = of G] (H) {ir-a};
    \node[box, below = of H, fill=gray!20] (I) {Postllamada};

    \draw[-latex, dashed] (E.east) -- ($(E.east)+(0.5,0)$) -- ($(I.north east)+(0.5,0)-(0,0.1)$) -- ($(I.north east)-(0,0.1)$);
    \draw[-latex, dashed] (H.west) -- ($(H.west)-(0.5,0)$) -- ($(B.north west)-(0.5,0.1)$) --($(B.north west)-(0,0.1)$);

	\end{tikzpicture}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Paso de parámetros}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros (durante la prellamada)}

\begin{itemize}[<+->]
	\item Las posiciones de los parámetros en el reg. de activación son relativas al \emph{CP}
	\item Durante la prellamada, el \emph{CP} apunta a la celda anterior a la primera del reg. de activación
	\item Por lo tanto, los parámetros y variables locales empezarán a partir de \emph{CP} + 3
	\item Sus direcciones deben precalcularse en ejecución (antes de ejecutar el método) y guardarse en la TS
\end{itemize}

\uncover<+->{¿Por qué deben precalcularse en ejecución?}
\uncover<+->{\\Por que el \emph{CP} se va moviendo y dejan de ser accesibles}
\uncover<+->{
\begin{columns}[T]
\column{.4\textwidth}
	Ejemplo: \textbf{proc suma(x:num, y:num);}
\column{.6\textwidth}
	\begin{tikzpicture}
	      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2em, align=center},
	      short/.style={minimum width = 1.8em}]

	    \node[box, fill=red!40] at (0,0) (x0) {\small{CP}};

	    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {\tiny{Displays}};

	    \node[box, right = of x1, fill=blue!40, minimum width=1em] (x5) {\tiny{?}};
	    \node[box, right = of x5, fill=blue!40, minimum width=1em] (x7) {\scriptsize{\ldots}};
	    \node[box, right = of x7, fill=blue!40, minimum width=1em] (x8) {\tiny{?}};

	    \node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
	    \node[box, right = of x9, fill=pink!40] (x10) {\small{¿?}};
	    \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {x};
	    \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {y};

	    \node[box, short, right = of x12] (x18) {\scriptsize{\ldots}};

	    \node[box, draw=none, above = of x11,rotate=45, xshift=1.5em,yshift=-0.5em] {\scriptsize{CP+3}};
	    \node[box, draw=none, above = of x12,rotate=45, xshift=1.5em,,yshift=-0.5em] {\scriptsize{CP+4}};

	    \draw[-latex, dashed] (x0.south) -- ($(x0.south)-(0,0.4)$) -- ($(x8.south)-(0,0.4)$) -- (x8.south);

	\end{tikzpicture}
\end{columns}
}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Por valor}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros por valor}

Dos formas:
\begin{enumerate}[<+->]
	\item modo \textbf{var}: proc1(\textbf{x});
	\item modo \textbf{val}: proc1(\textbf{3}); ó proc1(\textbf{x+1}); ó proc1(\textbf{3+4});\\
	Es decir, si pasa por la pila de evaluación, es de tipo \textbf{val}
\end{enumerate}

\uncover<+->{¿Que se hace en nuestra arquitectura?}
\begin{enumerate}[<+->]
	\item modo \textbf{var}: se copia el valor en el registro de activación (instrucción mueve)
	\item modo \textbf{val}: la cima de la pila de evaluación contendrá el valor de la expresión. Debemos desapilar el valor en el registro de activación
\end{enumerate}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros por valor: Gramática}

\textbf{var} es sólo para Mem. Las reglas que tienen operadores su modo es \textbf{val} ya que devuelven un tipo fijo (\emph{true, false, number})

\begin{columns}[T]
\column{.5\textwidth}
	\begin{lstlisting}[style=gramaticas,basicstyle=\footnotesize\ttfamily]
	Fact ::= Mem
	   Fact.modo = @green@var@
	Fact ::= num
	   Fact.modo = @b@val@
	Fact ::= true
	   Fact.modo = @b@val@
	Fact ::= false
	   Fact.modo = @b@val@
	Fact ::= ( Exp )
	   Fact.modo = Exp.modo
	Term ::= Term OpMul Fact
	   Term0.modo = @b@val@
	\end{lstlisting}

\column{.5\textwidth}
	\begin{lstlisting}[style=gramaticas,basicstyle=\footnotesize\ttfamily]
	Term ::= Fact
	   Term . modo = Fact.modo
	ExpS ::= ExpS OpAd Term
	   ExpS.modo = @b@val@
	ExpS ::= ExpS or Term
	   ExpS.modo = @b@val@
	ExpS ::= Term
	   ExpS.modo = Term.modo
	Exp ::= ExpS OpComp ExpS
	   Exp.modo = @b@val@
	Exp ::= ExpS
	   Exp.modo = ExpS.modo
	Term ::= Term and Fact
	   Term0.modo = @b@val@
	\end{lstlisting}

\end{columns}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros por valor: var}

\begin{itemize}
	\item modo \textbf{var}: se copia el valor en el
registro de activación (instrucción mueve, que copia un trozo de código a otras posiciones de memoria)
\end{itemize}

\begin{lstlisting}[style=codigo,basicstyle=\footnotesize\ttfamily]
par1:tpar; par2:tpar; resultado:num;
&
par1.x:=1; par1.y:=5; par2.x:=8; par2.y:=12;
distanciaEuclidea(@bold@par1,par2,& resultado@);
\end{lstlisting}

\begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2.7em, align=center},
      short/.style={minimum width = 1.8em}]

    \node[box, fill=red!40, minimum width=2em] at (0,0) (x0) {\small{0x17}};

    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {\small{0x4}};
    \node[box, right = of x1, fill=green!40, minimum width=1.5em] (x2) {\small{0x11}};
    \node[box, right = of x2, fill=green!40, minimum width=1.5em] (x3) {\tiny{?}};


    \node[box, right = of x3, fill=blue!40, minimum width=1em] (x4) {\small{1}};
    \node[box, right = of x4, fill=blue!40, minimum width=1em] (x5) {\small{5}};
    \node[box, right = of x5, fill=blue!40, minimum width=1em] (x6) {\small{8}};
    \node[box, right = of x6, fill=blue!40, minimum width=1em] (x7) {\small{12}};
    \node[box, right = of x7, fill=blue!40, minimum width=1em] (x8) {\small{res}};


    \node[box, right = of x8, fill=pink!40, minimum width=2em] (x9) {\small{0x87}};
    \node[box, right = of x9, fill=pink!40,minimum width=1em] (x10) {\tiny{?}};

    \uncover<-1>{
      \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {\tiny{?}};
      \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {\tiny{?}};
      \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\tiny{?}};
      \node[box, short, right = of x13, fill=cyan!40, minimum width=1.7em] (x14) {\tiny{?}};
      \node[box, short, right = of x14, fill=cyan!40, minimum width=1.2em] (x15) {\tiny{?}};
      \node[box, short, right = of x15, fill=cyan!40, minimum width=1.2em] (x16) {\tiny{?}};
      \node[box, short, right = of x16, fill=cyan!40, minimum width=1.2em] (x17) {\tiny{?}};
      \node[box, short, right = of x17] (x18) {\ldots};
    };
    \uncover<2->{
      \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {\small{1}};
      \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {\small{5}};
    };
    \uncover<2>{
      \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\tiny{?}};
      \node[box, short, right = of x13, fill=cyan!40, minimum width=1.7em] (x14) {\tiny{?}};
      \draw[-latex] (x5.south west) -- ($(x5.south west)-(0,0.4)$) -- ($(x12.south west)-(0,0.4)$) -- (x12.south west);
    };
    \uncover<3->{
      \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\small{8}};
      \node[box, short, right = of x13, fill=cyan!40, minimum width=1.7em] (x14) {\small{12}};
      \draw[-latex] (x7.south west) -- ($(x7.south west)-(0,0.4)$) -- ($(x14.south west)-(0,0.4)$) -- (x14.south west);
    };
    \uncover<2->{
      \node[box, short, right = of x14, fill=cyan!40, minimum width=1.2em] (x15) {\tiny{?}};
      \node[box, short, right = of x15, fill=cyan!40, minimum width=1.2em] (x16) {\tiny{?}};
      \node[box, short, right = of x16, fill=cyan!40, minimum width=1.2em] (x17) {\tiny{?}};
      \node[box, short, right = of x17] (x18) {\ldots};
    }

    \node[box, draw=none, above = of x0] {\small{0}};
    \node[box, draw=none, above = of x2] {\small{2}};
    \node[box, draw=none, above = of x4] {\small{4}};
    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] {\small{8}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};
    \node[box, draw=none, above = of x14] {\small{14}};
    \node[box, draw=none, above = of x16] {\small{16}};
    \node[box, draw=none, above = of x18] {\small{18}};

    \uncover<2->{
      \draw[|<->|] ($(x4.south west)+(0,1.7)$ ) -- node[fill=white]{main} ($(x8.south east)+(0,1.7)$);
      \draw[|<->|] ($(x9.south west)+(0,2.3)$ ) -- node[fill=white]{distEuclidea} ($(x17.south east)+(0,2.3)$);
      \draw[|<->|] ($(x11.south west)+(0,1.7)$ ) -- node[fill=white]{params} ($(x15.south east)+(0,1.7)$);
      \draw[|<->|] ($(x16.south west)+(0.06,1.7)$ ) -- node[fill=white]{loc} ($(x17.south east)+(0,1.7)$);
    };

\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros por valor: val}

\begin{itemize}
	\item modo \textbf{val}: la cima de la pila de
evaluación contendrá el valor de la expresión. Debemos desapilar el valor en el registro de activación
\end{itemize}

\begin{lstlisting}[style=codigo,basicstyle=\footnotesize\ttfamily]
proc distanciaEuclidea(p1:tpar, p2:tpar, & res:num)
   ...
   proc sumacuadrado(a:num, b:num, & r:num)
   ...
&
sumacuadrado(@blue@3*2@,@blue@7@,& res);
\end{lstlisting}

\begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2.7em, align=center},
      short/.style={minimum width = 1.8em}]

    \node[box, fill=red!40] at (0,0) (x0) {\small{0x17}};

    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {display};

    % main
    \node[box, right = of x1, fill=blue!40, minimum width=1em] (x4) {main};

    % distEuclidea
    \node[box, right = of x4, fill=pink!40] (x9) {\small{0x87}};
    \node[box, right = of x9, fill=pink!40,minimum width=1em] (x10) {\tiny{?}};
    \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {\small{1}};
    \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {\small{5}};
    \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\small{8}};
    \node[box, short, right = of x13, fill=cyan!40, minimum width=1.2em] (x14) {\small{12}};
    \node[box, short, right = of x14, fill=cyan!40, minimum width=1.2em] (x15) {\tiny{?}};
    \node[box, short, right = of x15, fill=cyan!40, minimum width=1.2em] (x16) {\tiny{?}};
    \node[box, short, right = of x16, fill=cyan!40, minimum width=1.2em] (x17) {\tiny{?}};

    % sumaCuadrado
    \node[box, short, right = of x17, fill=pink!40, minimum width=1.2em] (x18) {\small{217}};
    \node[box, short, right = of x18, fill=pink!40, minimum width=1.2em] (x19) {\tiny{?}};

    \uncover<1-1>{
      \node[box, short, right = of x19, fill=cyan!40, minimum width=1.2em] (x20) {\tiny{?}};
      \node[box, short, right = of x20, fill=cyan!40, minimum width=1.2em] (x21) {\tiny{?}};
    }
    % 6
    \uncover<2->{
      \node[box, short, right = of x19, fill=cyan!40, minimum width=1.2em] (x20) {\small{6}};
      \node[box, short, right = of x20, fill=cyan!40, minimum width=1.2em] (x21) {\tiny{?}};
    };
    \uncover<2-2>{
      \draw[-latex]  ($(x9.south)-(0,0.45)$) -- node[fill=white]{Pila de Eval.} ($(x20.south)-(0,0.45)$) -- (x20.south);
    }
    % 7
    \uncover<3->{
      \node[box, short, right = of x19, fill=cyan!40, minimum width=1.2em] (x20) {\small{6}};
      \node[box, short, right = of x20, fill=cyan!40, minimum width=1.2em] (x21) {\small{7}};
    };
    \uncover<3-3>{
      \draw[-latex]  ($(x9.south)-(0,0.45)$) -- node[fill=white]{Pila de Eval.} ($(x21.south)-(0,0.45)$) -- (x21.south);
    }

    \node[box, short, right = of x21, fill=cyan!40, minimum width=1.2em] (x22) {\tiny{?}};
    \node[box, short, right = of x22] (x23) {\ldots};

    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};
    \node[box, draw=none, above = of x14] {\small{14}};
    \node[box, draw=none, above = of x16] {\small{16}};
    \node[box, draw=none, above = of x18] {\small{18}};
    \node[box, draw=none, above = of x20] {\small{20}};
    \node[box, draw=none, above = of x22] {\small{22}};

    \uncover<2->{
      \draw[|<->|] ($(x9.south west)+(0,1.7)$ ) -- node[fill=white]{distEuclidea} ($(x17.south east)+(0,1.7)$);
      \draw[|<->|] ($(x18.south west)+(0,1.7)$ ) -- node[fill=white]{sumC} ($(x22.south east)+(0,1.7)$);
    };

\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Por variable(referencia)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros por variable(referencia) I}

\begin{itemize}[<+->]
	\item En la cima de la pila debe estar la dirección de comienzo de la variable pasada como parámetro. Dicha dirección se copia en el registro de activación
	\item En la evaluación de las expresiones debe retardarse el apilado de los valores de las direcciones para Mem
\end{itemize}

\uncover<+->{¿Cómo sabe el procemiento que ha sido por \textbf{variable (\&)}, y lo que hay en el registro de activación es una dirección de mem.?}
\uncover<+->{\\Se accede con indirección: Display + dir. de la variable de la TS}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros por variable(referencia) II}

\begin{itemize}
	\item En la cima de la pila debe estar la dirección de comienzo de la variable pasada como parámetro. Dicha dirección se copia en el registro de activación
\end{itemize}

\begin{lstlisting}[style=codigo,basicstyle=\footnotesize\ttfamily]
par1:tpar; par2:tpar; @blue@resultado:num;@
&
par1.x:=1; par1.y:=5; par2.x:=8; par2.y:=12;
@bold@distanciaEuclidea@(par1,par2,@bold@& resultado@);
\end{lstlisting}

\begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2.7em, align=center},
      short/.style={minimum width = 1.8em}]

    \node[box, fill=red!40] at (0,0) (x0) {\small{0x17}};

    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {display};

    % main
    \node[box, right = of x1, fill=blue!40, minimum width=1em] (x4) {\small{1}};
    \node[box, right = of x4, fill=blue!40, minimum width=1em] (x5) {\small{5}};
    \node[box, right = of x5, fill=blue!40, minimum width=1em] (x6) {\small{8}};
    \node[box, right = of x6, fill=blue!40, minimum width=1em] (x7) {\small{12}};
    \node[box, right = of x7, fill=blue!40, minimum width=1em] (x8) {\small{res}};

    % distEuclidea
    \node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
    \node[box, right = of x9, fill=pink!40,minimum width=1em] (x10) {\tiny{?}};
    \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {\small{1}};
    \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {\small{5}};
    \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\small{8}};
    \node[box, short, right = of x13, fill=cyan!40, minimum width=1.2em] (x14) {\small{12}};

    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] (etq8) {\small{\textbf{8}}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};

    \uncover<1-1>{
      \node[box, short, right = of x14, fill=cyan!40, minimum width=2em] (x15) {\tiny{?}};
    }
    \uncover<2->{
      \node[box, short, right = of x14, fill=cyan!40, minimum width=1.2em] (x15) {\small{0x8}};
    };
    \uncover<2-2>{
      \uncover<2->{\draw[-latex, dashed] ($(etq8.south)+(0,0.2)$) -- ($(x8.south)-(0,0.4)$) -- ($(x15.south)-(0,0.4)$) -- (x15.south);};
    }

    \node[box, short, right = of x15, fill=cyan!40, minimum width=1.2em] (x16) {\tiny{?}};
    \node[box, short, right = of x16, fill=cyan!40, minimum width=1.2em] (x17) {\tiny{?}};
    \node[box, short, right = of x17] (x18) {\ldots};

    \node[box, draw=none, above = of x14] {\small{14}};
    \node[box, draw=none, above = of x16] {\small{16}};

\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Amplicación de la TS}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros: ampliacion de la TS I}

\begin{itemize}
	\item Deben asignarse direcciones a los parámetros de los procedimientos:
\end{itemize}

\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
LFParams ::= LFParams, FParam
   LFParams0.ts = aniadeID(LFParams1.ts,FParam.id,
   FParam.props $\oplus$ @bold@<dir:LFParams1.dir>@)
   LFParams0.dir = LFParams1.dir + FParam.tam
   @bold@FParam.dirh = LFParams1.dir@
LFParam ::= FParam
   LFParam.ts = aniadeID(LFParam.tsph, FParam.id,FParam.props $\oplus$ @bold@<dir:0>@)
   LFParam.dir = FParam.tam
   @bold@FParam.dirh = 0@
FParam ::= & iden: Tipo // por referencia
   FParam.tam = @bold@1@ // es una direccion: integer.tam = 1
   Fparam.param = <modo: @blue@variable@, tipo: Tipo.tipo, @bold@dir: Fparam.dirh@>
FParam ::= id: Tipo // por valor
   FParam.tam = @bold@Tipo.tipo.tam@
   Fparam.param = <modo: @blue@valor@, tipo: Tipo.tipo, @bold@dir: Fparam.dirh@>
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros: ampliacion de la TS II}

\begin{itemize}
	\item La dirección de comienzo de un bloque de declaraciones no tiene que ser ya necesariamente cero, sino la dirección de fin del bloque de arámetros: las declaraciones reciben una dirección de comienzo heredada
\end{itemize}

\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
Prog ::= Decs && Is
   Decs.dirh = 0
DecProc ::= proc iden FParams Bloque fproc
   Bloque.dirh = FParams.dir
FParams ::= ( LFParams )
   FParams.dir = LFParams.dir
FParams ::= $\lambda$
   FParams.dir = 0
Bloque ::= Decs && I
   Decs.dirh = Bloque.dirh // las decs reciben dirheredada
Decs ::= Decs ; Dec
   Decs1.dirh = Decs0.dirh
Decs ::= Dec
   Decs.dir = Decs.dirh + Dec.tam
   Dec.dirh = Decs.dirh
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Paso de parámetros: ampliacion de la TS III}

\tiny
\begin{tabular*}{\textwidth}{|l|l|l|p{0.5\textwidth}|}
\textbf{nivel} & \textbf{id}       & \textbf{clase}    & \textbf{otras}                                                                                                                                                                                                                                                        \\ \hline
1              & p1                & var //valor       & $<tipo:<t:ref, id:tpar>, dir:0>$                                                                                                                                                                                                  \\ \hline
1              & p2                & var //valor       & $<tipo:<t:ref, id:tpar>, dir:2>$                                                                                                                                                                                                  \\ \hline
1              & res               & pvar //referencia & $<tipo:<t:num>, dir:4>$                                                                                                                                                                                                           \\ \hline
1              & distanciaEuclidea & prodedimiento     & $<tipo:<t:proc, params: {[}modo:valor{]}, tipo:<tipo:<t:red, id:tpar>{]}{[}modo:valor, tipo:<t:ref, id:tpar>{]}{[}modo:variable, tipo:<t:num>{]}>>>$ \\ \hline
1              & a                 & var //local       & $<tipo:<t:num>, dir:5>$                                                                                                                                                                                                           \\ \hline
1              & b                 & var //local       & $<tipo:<t:num>, dir:6>$                                                                                                                                                                                                           \\ \hline
               &                   & $\vdots$          &                                                                                                                                                                                                                                                                       \\ \hline
1              & sumaCuadrado      & procedimiento     & $<tipo:<t:proc, params: {[}modo:valor{]}, tipo:<tipo:<t:num>{]}{[}modo:valor, tipo:<t:num>{]}{[}modo:variable, tipo:<t:num>{]}>>>$                    \\ \hline
1              & raizCuadrada      & procedimiento     & $<tipo:<t:proc, params: {[}modo:valor{]}, tipo:<t:num>{]}>>$                                                                                                                                                   \\ \hline
\end{tabular*}

	\begin{tikzpicture}
		[box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2em, align=center},
		short/.style={minimum width = 1.8em}]

		\node[box, fill=red!40] at (0,0) (x0) {\small{0x17}};

		% displays
		\node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {\small{0x4}};
		\node[box, right = of x1, fill=green!40, minimum width=1.5em] (x2) {\small{0x11}};
		\node[box, right = of x2, fill=green!40, minimum width=1.5em] (x3) {\tiny{?}};

		% main
		\node[box, right = of x3, fill=blue!40, minimum width=2.5em] (x4) {\tiny{1}};
		\node[box, right = of x4, fill=blue!40, minimum width=2.5em] (x5) {\tiny{5}};
		\node[box, right = of x5, fill=blue!40, minimum width=2.5em] (x6) {\tiny{8}};
		\node[box, right = of x6, fill=blue!40, minimum width=2.5em] (x7) {\tiny{12}};
		\node[box, right = of x7, fill=blue!40, minimum width=2.5em] (x8) {\tiny{res}};

		% distEuclidea
		\node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
		\node[box, right = of x9, fill=pink!40,minimum width=1em] (x10) {\tiny{?}};
		\node[box, short, right = of x10, fill=cyan!40, minimum width=2.5em] (x11) {\tiny{1}};
		\node[box, short, right = of x11, fill=cyan!40, minimum width=2.5em] (x12) {\tiny{5}};
		\node[box, short, right = of x12, fill=cyan!40, minimum width=2.5em] (x13) {\tiny{8}};
		\node[box, short, right = of x13, fill=cyan!40, minimum width=2.5em] (x14) {\tiny{12}};
		\node[box, short, right = of x14, fill=cyan!40, minimum width=2.5em] (x15) {\tiny{0x8}};
		\node[box, short, right = of x15, fill=cyan!40, minimum width=2.5em] (x16) {\tiny{a}};
		\node[box, short, right = of x16, fill=cyan!40, minimum width=2.5em] (x17) {\tiny{b}};

		% labels
		\node[box, draw=none, above = of x11,rotate=45, xshift=1.5em,yshift=-0.5em] {\tiny{Disp+0}};
		\node[box, draw=none, above = of x12,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+1}};
		\node[box, draw=none, above = of x13,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+2}};
		\node[box, draw=none, above = of x14,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+3}};
		\node[box, draw=none, above = of x15,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+4}};
		\node[box, draw=none, above = of x16,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+5}};
		\node[box, draw=none, above = of x17,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+6}};

		\node[box, draw=none, above = of x0] {\small{0}};
		\node[box, draw=none, above = of x1] {\small{1}};
		\node[box, draw=none, above = of x2] {\small{2}};
		\node[box, draw=none, above = of x3] {\small{3}};
		\node[box, draw=none, above = of x4] {\small{4}};
		\node[box, draw=none, above = of x5] {\small{5}};
		\node[box, draw=none, above = of x6] {\small{6}};
		\node[box, draw=none, above = of x7] {\small{7}};
		\node[box, draw=none, above = of x8] {\small{8}};
		\node[box, draw=none, above = of x9] {\small{9}};
		\node[box, draw=none, above = of x10] {\small{10}};
	\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Acceso a las variables y parámetros desde el procedimiento}

\begin{itemize}
	\item Desplazamiento relativo al valor del display del bloque en el que reside la variable
	\item Además, si el parámetro es por variable(referencia) (tipo \emph{pvar}), debe realizarse un apilado indirecto para acceder al enlace en sí
\end{itemize}

\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily,mathescape]
fun accesoVar(id) devuelve
   apila-dir(0x1+id.nivel)    ||  // dir del display
   apila(id.dir)              ||  // desplazamiento respecto al display
   suma                           // traer dir o valor a Cima
   // aqui nos falta un apila_ind !!!
   ( si id.clase = pvar entonces apila-ind
   si no $\lambda$ )
ffun

fun longAccesoVar(id)
   si id.clase = pvar entonces 4
   si no 3
ffun
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Traducción}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Inicio}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Inicio I}

\begin{itemize}
	\item Al iniciar la traducción, necesitamos reservar espacio para los displays
	\item Para ello, usamos la función \emph{inicio()}
\end{itemize}

\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily,mathescape]
fun inicio(numNiveles,tamDatos)
   apila(numNiveles+2)
   desapila-dir(0x1)
   apila(1+numNiveles+tamDatos)
   desapila-dir(0x0)
ffun

cons longInicio = 4
\end{lstlisting}

Ejemplo: \textbf{inicio(2,5)}

	\begin{tikzpicture}
	[box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2.2em, align=center}]
		\node[box, fill=red!40] at (0,0) (x0) {0x8};

		\node[box, right = of x0, fill=green!40] (x1) {\textbf{0x4}};
		\node[box, right = of x1, fill=green!40] (x2) {\textbf{?}};
		\node[box, right = of x2, fill=green!40] (x3) {\textbf{?}};

		\node[box, right = of x3, fill=blue!40] (x4) {\tiny{ }};
		\node[box, right = of x4, fill=blue!40] (x5) {\tiny{ }};
		\node[box, right = of x5, fill=blue!40] (x6) {\tiny{ }};
		\node[box, right = of x6, fill=blue!40] (x7) {\tiny{ }};
		\node[box, right = of x7, fill=blue!40] (x8) {\tiny{ }};

		\node[box, right = of x8] (x12) {\ldots};

		\node[box, draw=none, above = of x0] {\small{0}};
		\node[box, draw=none, above = of x2] {\small{2}};
		\node[box, draw=none, above = of x4] {\small{4}};
		\node[box, draw=none, above = of x6] {\small{6}};
		\node[box, draw=none, above = of x8] {\small{8}};

		\draw[-latex, dashed] (x1.south) -- ($(x1.south)-(0,0.2)$) -- ($(x4.south)-(0,0.2)$) -- (x4.south);
		\draw[-latex, dashed] (x0.south) -- ($(x0.south)-(0,0.5)$) -- ($(x8.south)-(0,0.5)$) -- (x8.south);

	\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Inicio II}

\begin{itemize}
	\item Para reservar el espacio, es necesario conocer el nivel de anidamiento, que se sintetiza en las declaraciones:
\end{itemize}

\begin{columns}[T]
\column{.5\textwidth}
	\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
	Prog ::= Decs && Is
	   Decs.nh = 0
	Decs ::= Decs ; Dec
	   Decs1.nh = Decs0.nh
	   Decs0.n = @bold@max(Decs1.n,Dec.n)@
	Decs ::= Dec
	   Dec.nh = Decs.nh
	   Decs.n = Dec.n
	Dec ::= DecVar
	   Dec.n = Dec.nh
	Dec ::= DecTipo
	   Dec.n = Dec.nh
	Dec ::= DecProc
	   DecProc.nh = Dec.nh
	   Dec.n = DecProc.n
	\end{lstlisting}

\column{.5\textwidth}
	\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
	DecProc ::= proc iden FParams Bloque fproc
	   FParams.nh = Bloque.nh = @bold@DecProc.nh + 1@
	   DecProc.n = Bloque.n
	Bloque ::= Decs && I
	   Decs.nh = Bloque.nh
	   Bloque.n = Decs.n
	Bloque ::= I
	   Bloque.n = Bloque.nh
	\end{lstlisting}
\end{columns}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Inicio III}

\begin{itemize}
	\item Conocido el tamaño de los displays, la traducción del programa se especifica como:
\end{itemize}

\begin{columns}[T]
\column{.6\textwidth}
	\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
	Prog ::= Decs && Is //Subprogs $\in$ Decs
	   Proc.cod = @bold@inicio(Decs.n,Decs.dir)@ || // Decs.dir: tam del main
	   @bold@ir-a(Decs.etq)@                     ||
	   Decs.cod  || // aqui van los Subprogs
	   Is.cod    ||
	   stop
	   Decs.etqh = longInicio +1 // +1: ir-a
	   Is.etqh = Decs.etq
	\end{lstlisting}

\column{.4\textwidth}
	\uncover<+->{
		\begin{tikzpicture}
		[minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
		box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=10em, text width=8em,align=center}]

			\node[box, fill=gray!40, anchor=west] at (2,-1.5) (tA) {Inicio};
			\node[box, below = of tA, minimum height=2em] (tB) {ir-a};
			\node[box, below = of tB, minimum height=4em] (tC) {Traducción de subprogramas};
			\node[box, below = of tC, minimum height=4em, fill=gray!20] (tD) {Traducción bloque principal};

			\draw[-latex,dashed] (tB.east) -- ($(tB.east)+(0.5,0)$) -- ($(tD.north east)+(0.5,0)-(0,0.2)$) -- ($(tD.north east)-(0,0.2)$);

		\end{tikzpicture}
	}

\end{columns}
\uncover<+->{¿Hay que parchear?\\}
\uncover<+->{Sí, el ir-a para apuntar al main, del cual no sabemos su dir todavía}


\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Declaraciones}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Declaraciones}

\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
Prog ::= Decs && Is
Decs ::= Decs ; Dec
   Decs1.etqh = Decs0.etqh
   Dec.etqh = Decs1.etq
   Decso.etq = Dec.etq
   Decs0.cod = Decs1.cod || Dec.cod
Decs ::= Dec
   Dec.etqh = Decs.etqh
   Decs.etq = Dec.etq
   Decs.cod = Dec.cod
Dec ::= DecVar
   Dec.cod = @bold@$\lambda$@ // solo afecta a la TS
   Dec.etq = Dec.etqh
Dec ::= DecTipo
   Dec.cod = @bold@$\lambda$@ // solo afecta a la TS
Dec.etq = Dec.etqh
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Procedimientos}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Procedimientos I}

\begin{itemize}
	\item Al traducir un procedimiento añadimos a la TS su dirección de inicio (para luego realizar el salto en la invocación)
\end{itemize}

\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
Dec ::= DecProc
   DecProc.etqh = Dec.etqh
   Dec.etq = DecProc.etq
   Dec.cod = DecProc.cod
   Dec.propsop = @bold@DecProc.propsop@ // hay que parchear

DecProc ::= proc iden FParams Bloque fproc
   DecProc.cod = Bloque.cod
   DecProc.propsop = @bold@<inicio:Bloque.inicio>@ // Bloque.inicio: dir donde empieza el proc.
   Bloque.etqh = DecProc.etqh
   DecProc.etq = Bloque.etq
   Bloque.tsph = aniadeID(FParams.ts, DecProp.id,
   	             DecProc.props $\oplus$ {nivel:DecsProp.nh +1}
                 $\oplus$ @bold@DecProc.propsop@)
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Procedimientos II}

\tiny
\begin{tabular*}{\textwidth}{|l|l|l|p{0.5\textwidth}|}
\textbf{nivel} & \textbf{id}       & \textbf{clase}    & \textbf{otras}                                                                                                                                                                                                                                                        \\ \hline
0              & tpar              & tipo              & $<tipo:<t:rec, campos:[id:x,tipo:<t:num>,desp:0][id:y,tipo:<t:num>,desp:1]>, tam:2>$      \\ \hline
0              & par1              & var //valor       & $<tipo:<t:ref, id:tpar>>$                                                                 \\ \hline
0              & par2              & var //valor       & $<tipo:<t:ref, id:tpar>>$                                                                 \\ \hline
1              & resultado         & pvar //referencia & $<tipo:<t:num>>$                                                                          \\ \hline
1              & distanciaEuclidea & prodedimiento     & $<tipo:<t:proc, params: [modo:valor, tipo:<t:ref,id:tpar>][modo:valor,tipo:<t:ref,id:tpar>][modo:variable,tipo:<t:num>]>inicio:6>$ \\ \hline
\end{tabular*}

inicio: Dir de la 1ºa instrucción (despues de \emph{Decs})

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Bloque de código del proc.}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Bloque de código del proc.}

\begin{columns}[T]
\column{.7\textwidth}
	\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
	Bloque ::= Decs && I
	   Decs.etqh = Bloque.etqh
	   @bold@Bloque.inicio@ = Decs.etq
	   I.etqh = Decs.etq + longPrologo
	   Bloque.etq = I.etq + longEpilogo + 1
	   @bold@Bloque.cod = Decs.cod ||
	                      prologo(Bloque.nh,
	                              Decs.dir) ||
	                      I.cod  ||
	                      epilogo(Bloque.nh ) ||
	                      ir-ind@
	\end{lstlisting}

\column{.3\textwidth}
	\begin{tikzpicture}
	[minibox/.style={draw, node distance=0pt, outer sep=0pt, minimum height=3em},
	box/.style={draw, node distance=0pt, outer sep=0pt, minimum width=4em, text width=4em,align=center}]
		\node[box, below = of A, fill=gray!20] (B) {Prólogo};
		\node[box, below = of B] (C) {Cuerpo};
		\node[box, below = of C, fill=gray!20] (D) {Epílogo};
		\node[box, below = of D] (E) {ir-ind};

		\draw[-latex, dashed]  ($(B.west)+(-2,0.2)$) -- node[fill=white, minimum width=1.2em]{\tiny{Bloque.inicio}} ($(B.west)+(0,0.2)$);
		\draw[-latex, dashed]  ($(C.west)+(-2,0.2)$) -- node[fill=white, minimum width=1.2em]{\tiny{Is.etqh}} ($(C.west)+(0,0.2)$);
		\draw[-latex, dashed]  ($(E.west)+(-2,0)$) -- node[fill=white, minimum width=1.2em]{\tiny{Bloque.etqh}} (E.west);

	\end{tikzpicture}

\end{columns}

	\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
	Bloque ::= I
	   @bold@Bloque.cod = prologo(Bloque.nh, Bloque.dirh ) ||
	                I.cod               ||
	                epilogo(Bloque.nh ) ||
	                ir-ind@
	   I.etqh = Bloque.etqh + longPrologo
	   Bloque.inicio = Bloque.etqh
	   Bloque.etq = I.etq + longEpilogo + 1
	\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Invocaciones}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Invocaciones I}

\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
I ::= ICall
   ICall.etqh = I.etqh
   I.etq = ICall.etq
   I.cod = ICall.cod
ICall ::= iden AParams
   @bold@ICall.cod = // Prellamada:
               apila-ret(ICall.etq) || // parchear a despues de proc
               AParams.cod          || // cod de '3+a'
               ir-a(ICall.tsh [iden.lex].inicio)@
   AParams.etqh = Icall.etqh + longApilaRet
   ICall.etq = AParams.etq +1// +1: ir-a
AParams ::= LAparams
   AParams.cod = @bold@inicio-paso || LAParams.cod || fin-paso@
   LAParams.etqh = AParams.etqh + longInicioPaso
   AParams.etq = LAParams.etq + longFinPaso
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Invocaciones II (paso parámetros)}

\begin{itemize}
	\item El inicio del paso de parámetros apila la dirección de comienzo de los parámetros en el display: \emph{CP} + 3
\end{itemize}

\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily,mathescape]
cons inicio-paso = apila-dir(0x0) || // apila el CP
                   apila(3)       || // salta ret, display antiguo
                   suma
cons longInicioPaso = 3
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Invocaciones II (paso parámetros)}

\begin{itemize}
	\item El inicio del paso de parámetros apila la dirección de comienzo de los parámetros en el display: \emph{CP} + 3
\end{itemize}

\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily,mathescape]
cons inicio-paso = apila-dir(0x0) || // apila el CP
                   apila(3)       || // salta ret, display antiguo
                   suma
cons longInicioPaso = 3
\end{lstlisting}

\begin{itemize}
	\item Este valor permanece en la pila para ser utilizado por cada parámetro (que lo copiará)
\end{itemize}

\begin{itemize}
	\item Por lo tanto, el fin del paso de parámetros simplemente desapila la dirección de comienzo de los parámetros
\end{itemize}

\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily,mathescape]
cons fin-paso = desapila
cons longFinPaso = 1
\end{lstlisting}


\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Invocaciones III (paso parám., func. auxiliares)}

\begin{itemize}
	\item Función para obtener la dirección de un parámetro en el registro de activación
\end{itemize}

\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily,mathescape]
fun direccionParFormal(pformal) devuelve
   apila(pformal.dir) || // dir relativa al procedimiento
   suma
ffun
fun longdireccionParFormal(pformal) devuelve 2 ffun
\end{lstlisting}

\begin{itemize}
	\item Función para realizar el paso de los parámetros
\end{itemize}

\begin{lstlisting}[style=codigoMP,basicstyle=\scriptsize\ttfamily,mathescape]
fun pasoParametro(tipoParamPorValor,pformal) devuelve
   si pformal.modo = val $\wedge$ tipoParamPorValor = var
       // hay que apilar dir de origen del parametro. Se hace mas adelante en accesoVar()
       mueve(pformal.tipo.tam) // copia del valor en el caso de expr. mem
   si no desapila-ind          // copia del valor,0bien de la direcc.
ffun
fun longPasoParametro(tipoParamPorValor,pformal) devuelve1ffun
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Invocaciones IV}

\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
AParams ::= $\lambda$
   AParams.cod = $\lambda$
   AParams.etq = AParams.etqh
LAParams ::= LAParams, Exp
   @bold@LAParams0.cod = LAParams1.cod        ||
                   copia                ||
                   direccionParFormal(
                   	    LAParams0.fparams[LAParams0.nparams]
                   	    )               ||
                   Exp.cod              ||
                   pasoParametro(Exp.modo,
                            LAParams0.fparams[LAParams0.nparams])@
   LAParams1.etqh = LAParams0.etqh
   Exp.etqh = LAParams1.etq+1
   LAParams0.etq = Exp.etq +1+
                   longDireccionParFormal(
                   	        LAParams0.fparams[LAParams0.nparams])+
                   longPasoParametro(Exp.modo, LAParams0.fparams[LAParams0.nparams])
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Invocaciones V}


\begin{lstlisting}[style=gramaticas,basicstyle=\scriptsize\ttfamily,mathescape]
LAParams ::= Exp
   @bold@LAParams.cod = copia   ||
                  Exp.cod ||
                  pasoParametro(Exp.modo,LAParams.fparams[1])@
   Exp.etqh = LAParams.etq+1
   LAParams.etq = Exp.etq +1+
                  longPasoParametro(Exp.modo, LAParams.fparams[1])
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Modificación en la traducción}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Modificación en la trad. de expresiones I}

\begin{itemize}
	\item Problema con el paso de parámetros por variable(referencia):
		\begin{itemize}
			\item En la cima de la pila debe de estar la dirección de comienzo de la variable pasada como parámetro. Dicha dirección se copia en el registro de activación
		\end{itemize}
	\item Sin embargo, en las expresiones \emph{Mem} hay un \emph{apila-ind} que deja su valor (no la dirección) en la cima
\end{itemize}

\begin{lstlisting}[style=codigo,basicstyle=\footnotesize\ttfamily]
par1:tpar; par2:tpar; @bold@resultado:num;@
&
par1.x:=1; par1.y:=5; par2.x:=8; par2.y:=12;
@bold@distanciaEuclidea@(par1,par2,@bold@resultado@);
\end{lstlisting}

\begin{tikzpicture}
      [box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2.7em, align=center},
      short/.style={minimum width = 1.8em}]

    \node[box, fill=red!40] at (0,0) (x0) {\small{0x17}};

    \node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {display};

    % main
    \node[box, right = of x1, fill=blue!40, minimum width=1em] (x4) {\small{1}};
    \node[box, right = of x4, fill=blue!40, minimum width=1em] (x5) {\small{5}};
    \node[box, right = of x5, fill=blue!40, minimum width=1em] (x6) {\small{8}};
    \node[box, right = of x6, fill=blue!40, minimum width=1em] (x7) {\small{12}};
    \node[box, right = of x7, fill=blue!40, minimum width=1em] (x8) {\small{res}};

    % distEuclidea
    \node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
    \node[box, right = of x9, fill=pink!40,minimum width=1em] (x10) {\tiny{?}};
    \node[box, short, right = of x10, fill=cyan!40, minimum width=1.2em] (x11) {\small{1}};
    \node[box, short, right = of x11, fill=cyan!40, minimum width=1.2em] (x12) {\small{5}};
    \node[box, short, right = of x12, fill=cyan!40, minimum width=1.2em] (x13) {\small{8}};
    \node[box, short, right = of x13, fill=cyan!40, minimum width=1.2em] (x14) {\small{12}};

    \node[box, draw=none, above = of x6] {\small{6}};
    \node[box, draw=none, above = of x8] (etq8) {\small{\textbf{8}}};
    \node[box, draw=none, above = of x10] {\small{10}};
    \node[box, draw=none, above = of x12] {\small{12}};
    \node[box, short, right = of x14, fill=cyan!40, minimum width=1.2em] (x15) {\small{0x8}};
    \uncover<2->{\draw[-latex, dashed] ($(etq8.south)+(0,0.2)$) -- ($(x8.south)-(0,0.4)$) -- ($(x15.south)-(0,0.4)$) -- (x15.south);};

    \node[box, short, right = of x15, fill=cyan!40, minimum width=1.2em] (x16) {\tiny{?}};
    \node[box, short, right = of x16, fill=cyan!40, minimum width=1.2em] (x17) {\tiny{?}};
    \node[box, short, right = of x17] (x18) {\ldots};

    \node[box, draw=none, above = of x14] {\small{14}};
    \node[box, draw=none, above = of x16] {\small{16}};

\end{tikzpicture}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Modificación en la trad. de expresiones II}

\textbf{Solución}:
\begin{itemize}
	\item Debe evitarse cargar adelantadamente el valor de las posiciones de memoria cuando éstas aparecen como parámetros reales
	\item A fin de no modificar el esquema de generación de código de las expresiones y asignación, la solución menos intrusiva es determinar si el contexto de ocurrencia de un designador (derivado de \emph{Mem}) es como parámetro real: atributo heredado \emph{parh}
\end{itemize}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Modificación en la trad. de expresiones III}

\begin{columns}[T]
\column{.5\textwidth}
	\begin{lstlisting}[style=gramaticas,basicstyle=\footnotesize\ttfamily]
	Exp ::= ExpS OpComp ExpS
	   ExpS0.parh = ExpS1.parh = false
	Exp ::= ExpS
	   ExpS.parh = Exp.parh
	ExpS ::= ExpS OpAd Term
	   ExpS1.parh = Term.parh = false
	ExpS ::= ExpS or Term
	   ExpS1.parh = Term.parh = false
	\end{lstlisting}
\column{.5\textwidth}
	\begin{lstlisting}[style=gramaticas,basicstyle=\footnotesize\ttfamily]
	ExpS ::= Term
	   Term.parh = ExpS.parh
	Term.parh = ExpS.parh
	Term ::= Term OpMul Fact
	   Term1.parh = Fact.parh = false
	Term ::= Term and Fact
	   Term1.parh = Fact.parh = false
	Term ::= Fact
	   Fact.parh = Term.parh
	Fact ::= (Exp)
	   Exp.parh	= Fact.parh
	Fact ::= OpUn Fact
	   Fact1.parh = false
	\end{lstlisting}
\end{columns}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Modificación en la trad. de expresiones IV}

\begin{itemize}
	\item Los valores iniciales deben fijarse allí donde pueda aparecer una expresión:
\end{itemize}

\begin{lstlisting}[style=gramaticas,basicstyle=\footnotesize\ttfamily]
IAsig ::= Mem := Exp
   Exp.parh = false
IIf ::= if Exp then I PElse
   Exp.parh = false
IWhile ::= while Exp do I PElse
   Exp.parh = false
LAParams ::= LAParams,Exp
   Exp.parh = (LAParams0.fparamsh[LAParams0.nparams].modo == var)
LAParams ::= Exp
   Exp.parh = (LAParams0.fparamsh[1].modo == var)
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Modificación en la trad. de expresiones V}

\begin{itemize}
	\item Ahora la generación de código para \emph{Mem} puede modificarse como sigue:
\end{itemize}

\begin{lstlisting}[style=gramaticas,basicstyle=\footnotesize\ttfamily,mathescape]
Fact ::= Mem
   Fact.cod = si compatible(Mem.tipo,<t:num>,Fact.tsh ) $\lor$
                 compatible(Mem.tipo,<t:bool>,Fact.tsh ) $\land$
                 @bold@$\neg$ Fact.parh@
              entonces
                  @bold@Mem.cod || apila-ind@ // Por valor
              si no @bold@Mem.cod@            // Por variable
Fact.etq = si compatible(Mem.tipo,<t:num>,Fact.tsh ) $\lor$
              compatible(Mem.tipo,<t:bool>,Fact.tsh ) $\land$
              $\neg$ Fact.parh
           entonces
              Mem.etq + 1
           si no Mem.etq
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Modificación en la trad. de expresiones VI}

\begin{itemize}
	\item El otro aspecto a modificar es el acceso a los identificadores: ahora debe computarse adecuadamente el enlace a los mismos:
\end{itemize}

\begin{lstlisting}[style=gramaticas,basicstyle=\footnotesize\ttfamily,mathescape]
Mem ::= id
   Mem.cod = @bold@accesoVar@(Mem.tsh [id.lex])
   Mem.etq = Mem.etqh + @bold@longAccesoVar@(Mem.tsh [id.lex])
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Acceso a variables y parámetros}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Acceso a las variables y parámetros desde el proc. I}

\begin{itemize}
	\item Desplazamiento relativo al valor del display del bloque en el que reside la variable
	\item Además, si el parámetro es por variable(referencia) (tipo \emph{pvar}), debe realizarse un apilado indirecto para acceder al enlace en sí
\end{itemize}

\begin{lstlisting}[style=codigoMP,basicstyle=\tiny\ttfamily,mathescape]
fun accesoVar(id) devuelve
   apila-dir(0x1+id.nivel) ||
   apila(id.dir)           ||
   suma
   ( si id.clase = pvar entonces apila-ind
   si no $\lambda$ )
ffun

fun longAccesoVar(id) devuelve
   si id.clase = pvar entonces 4
   si no 3
ffun
\end{lstlisting}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Traducción: Acceso a las variables y parámetros desde el proc. II}

\tiny
\begin{tabular*}{\textwidth}{|l|l|l|p{0.5\textwidth}|}
\textbf{nivel} & \textbf{id}       & \textbf{clase}    & \textbf{otras}                                                                                                                                                                                                                                                        \\ \hline

0              & par1              & var //valor       & $<tipo:<t:ref, id:tpar>>$                                                                 \\ \hline
0              & par2              & var //valor       & $<tipo:<t:ref, id:tpar>>$                                                                 \\ \hline
1              & resultado         & pvar //referencia & $<tipo:<t:num>>$                                                                          \\ \hline
1              & distanciaEuclidea & prodedimiento     & $<tipo:<t:proc, params: [modo:valor, tipo:<t:ref,id:tpar>][modo:valor,tipo:<t:ref,id:tpar>][modo:variable,tipo:<t:num>]>inicio:6>$ \\ \hline
1              & a                 & pvar //referencia & $<tipo:<t:num>>$                                                                          \\ \hline
1              & b                 & pvar //referencia & $<tipo:<t:num>>$                                                                          \\ \hline
1              & sumaCuadrado      & prodedimiento     & $<tipo:<t:proc, params: [modo:valor, tipo:<t:num>][modo:valor,tipo:<t:numr>][modo:variable,tipo:<t:num>]>>$ \\ \hline
1              & raizCuadrada      & prodedimiento     & $<tipo:<t:proc, params: [modo:variable,tipo:<t:num>]>>$ \\ \hline
\end{tabular*}

	\begin{tikzpicture}
		[box/.style={draw, node distance=0pt, outer sep=0pt, minimum height=2em, minimum width=2em, align=center},
		short/.style={minimum width = 1.8em}]

		\node[box, fill=red!40] at (0,0) (x0) {\small{0x17}};

		% displays
		\node[box, right = of x0, fill=green!40, minimum width=1.5em] (x1) {\small{0x4}};
		\node[box, right = of x1, fill=green!40, minimum width=1.5em] (x2) {\small{0x11}};
		\node[box, right = of x2, fill=green!40, minimum width=1.5em] (x3) {\tiny{?}};

		% main
		\node[box, right = of x3, fill=blue!40, minimum width=2.5em] (x4) {\tiny{1}};
		\node[box, right = of x4, fill=blue!40, minimum width=2.5em] (x5) {\tiny{5}};
		\node[box, right = of x5, fill=blue!40, minimum width=2.5em] (x6) {\tiny{8}};
		\node[box, right = of x6, fill=blue!40, minimum width=2.5em] (x7) {\tiny{12}};
		\node[box, right = of x7, fill=blue!40, minimum width=2.5em] (x8) {\tiny{res}};

		% distEuclidea
		\node[box, right = of x8, fill=pink!40] (x9) {\small{0x87}};
		\node[box, right = of x9, fill=pink!40,minimum width=1em] (x10) {\tiny{?}};
		\node[box, short, right = of x10, fill=cyan!40, minimum width=2.5em] (x11) {\tiny{1}};
		\node[box, short, right = of x11, fill=cyan!40, minimum width=2.5em] (x12) {\tiny{5}};
		\node[box, short, right = of x12, fill=cyan!40, minimum width=2.5em] (x13) {\tiny{8}};
		\node[box, short, right = of x13, fill=cyan!40, minimum width=2.5em] (x14) {\tiny{12}};
		\node[box, short, right = of x14, fill=cyan!40, minimum width=2.5em] (x15) {\tiny{0x8}};
		\node[box, short, right = of x15, fill=cyan!40, minimum width=2.5em] (x16) {\tiny{a}};
		\node[box, short, right = of x16, fill=cyan!40, minimum width=2.5em] (x17) {\tiny{b}};

		% labels
		\node[box, draw=none, above = of x11,rotate=45, xshift=1.5em,yshift=-0.5em] {\tiny{Disp+0}};
		\node[box, draw=none, above = of x12,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+1}};
		\node[box, draw=none, above = of x13,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+2}};
		\node[box, draw=none, above = of x14,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+3}};
		\node[box, draw=none, above = of x15,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+4}};
		\node[box, draw=none, above = of x16,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+5}};
		\node[box, draw=none, above = of x17,rotate=45, xshift=1.5em,,yshift=-0.5em] {\tiny{Disp+6}};

		\node[box, draw=none, above = of x0] {\small{0}};
		\node[box, draw=none, above = of x1] {\small{1}};
		\node[box, draw=none, above = of x2] {\small{2}};
		\node[box, draw=none, above = of x3] {\small{3}};
		\node[box, draw=none, above = of x4] {\small{4}};
		\node[box, draw=none, above = of x5] {\small{5}};
		\node[box, draw=none, above = of x6] {\small{6}};
		\node[box, draw=none, above = of x7] {\small{7}};
		\node[box, draw=none, above = of x8] {\small{8}};
		\node[box, draw=none, above = of x9] {\small{9}};
		\node[box, draw=none, above = of x10] {\small{10}};
	\end{tikzpicture}


\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{?}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
\frametitle{Preguntas}
	\begin{center}
	\includegraphics[keepaspectratio, width=\textwidth]{question.png}
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
